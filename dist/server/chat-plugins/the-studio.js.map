{
  "version": 3,
  "sources": ["../../../server/chat-plugins/the-studio.ts"],
  "sourcesContent": ["/**\n * The Studio room chat-plugin.\n * Supports scrobbling and searching for music from last.fm.\n * Also supports storing and suggesting recommendations.\n * Written by dhelmise, loosely based on the concept from bumbadadabum.\n * @author dhelmise\n */\n\nimport { FS, Net, Utils } from '../../lib';\nimport { YouTube, type VideoData } from './youtube';\n\nconst LASTFM_DB = 'config/chat-plugins/lastfm.json';\nconst RECOMMENDATIONS = 'config/chat-plugins/the-studio.json';\nconst API_ROOT = 'http://ws.audioscrobbler.com/2.0/';\nconst DEFAULT_IMAGES = [\n\t'https://lastfm.freetls.fastly.net/i/u/34s/2a96cbd8b46e442fc41c2b86b821562f.png',\n\t'https://lastfm.freetls.fastly.net/i/u/64s/2a96cbd8b46e442fc41c2b86b821562f.png',\n\t'https://lastfm.freetls.fastly.net/i/u/174s/2a96cbd8b46e442fc41c2b86b821562f.png',\n\t'https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png',\n];\n\ninterface Recommendation {\n\tartist: string;\n\ttitle: string;\n\turl: string;\n\tvideoInfo: VideoData | null;\n\tdescription: string;\n\ttags: string[];\n\tuserData: {\n\t\tname: string,\n\t\tavatar?: string,\n\t};\n\tlikes: number;\n\tliked?: {\n\t\tips: string[],\n\t\tuserids: string[],\n\t};\n}\n\ninterface Recommendations {\n\tsuggested: Recommendation[];\n\tsaved: Recommendation[];\n\t// Storing here so I don't need to rewrite the lastfm json\n\tyoutubeSearchDisabled?: boolean;\n}\n\nconst lastfm: { [userid: string]: string } = JSON.parse(FS(LASTFM_DB).readIfExistsSync() || \"{}\");\nconst recommendations: Recommendations = JSON.parse(FS(RECOMMENDATIONS).readIfExistsSync() || \"{}\");\n\nif (!recommendations.saved) recommendations.saved = [];\nif (!recommendations.suggested) recommendations.suggested = [];\nsaveRecommendations();\n\nfunction updateRecTags() {\n\tfor (const rec of recommendations.saved) {\n\t\tif (!rec.tags.map(toID).includes(toID(rec.artist))) rec.tags.push(rec.artist);\n\t\tif (!rec.tags.map(toID).includes(toID(rec.userData.name))) rec.tags.push(rec.userData.name);\n\t}\n\tfor (const rec of recommendations.suggested) {\n\t\tif (!rec.tags.map(toID).includes(toID(rec.artist))) rec.tags.push(rec.artist);\n\t\tif (!rec.tags.map(toID).includes(toID(rec.userData.name))) rec.tags.push(rec.userData.name);\n\t}\n\tsaveRecommendations();\n}\n\nupdateRecTags();\n\nfunction saveLastFM() {\n\tFS(LASTFM_DB).writeUpdate(() => JSON.stringify(lastfm));\n}\nfunction saveRecommendations() {\n\tFS(RECOMMENDATIONS).writeUpdate(() => JSON.stringify(recommendations));\n}\n\nexport class LastFMInterface {\n\tasync getScrobbleData(username: string, displayName?: string) {\n\t\tthis.checkHasKey();\n\t\tconst accountName = this.getAccountName(username);\n\t\tlet raw;\n\t\ttry {\n\t\t\traw = await Net(API_ROOT).get({\n\t\t\t\tquery: {\n\t\t\t\t\tmethod: 'user.getRecentTracks', user: accountName,\n\t\t\t\t\tlimit: 1, api_key: Config.lastfmkey, format: 'json',\n\t\t\t\t},\n\t\t\t});\n\t\t} catch {\n\t\t\tthrow new Chat.ErrorMessage(`No scrobble data found.`);\n\t\t}\n\t\tconst res = JSON.parse(raw);\n\t\tif (res.error) {\n\t\t\tthrow new Chat.ErrorMessage(`${res.message}.`);\n\t\t}\n\t\tif (!res?.recenttracks?.track?.length) throw new Chat.ErrorMessage(`last.fm account not found.`);\n\t\tconst track = res.recenttracks.track[0];\n\t\tlet buf = `<table><tr>`;\n\t\tif (track.image?.length) {\n\t\t\tconst imageIndex = track.image.length >= 3 ? 2 : track.image.length - 1;\n\t\t\tif (track.image[imageIndex]['#text']) {\n\t\t\t\tbuf += `<td style=\"padding-right:5px\"><img src=\"${track.image[imageIndex]['#text']}\" width=\"75\" height=\"75\" /></td>`;\n\t\t\t}\n\t\t\tbuf += `<td><strong><a href=\"https://www.last.fm/user/${accountName}\">${Utils.escapeHTML(displayName || accountName)}</a></strong>`;\n\t\t\tif (track['@attr']?.nowplaying) {\n\t\t\t\tbuf += ` is currently listening to:`;\n\t\t\t} else {\n\t\t\t\tbuf += ` was last seen listening to:`;\n\t\t\t}\n\t\t\tbuf += `<br />`;\n\t\t\tconst trackName = `${track.artist?.['#text'] ? `${track.artist['#text']} - ` : ''}${track.name}`;\n\t\t\tlet videoIDs: string[] | undefined;\n\t\t\ttry {\n\t\t\t\tvideoIDs = await YouTube.searchVideo(trackName, 1);\n\t\t\t} catch (e: any) {\n\t\t\t\tif (!recommendations.youtubeSearchDisabled) {\n\t\t\t\t\tthrow new Chat.ErrorMessage(`Error while fetching video data: ${e.message}`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!videoIDs?.length && !recommendations.youtubeSearchDisabled) {\n\t\t\t\tthrow new Chat.ErrorMessage(`Something went wrong with the YouTube API.`);\n\t\t\t}\n\t\t\tif (recommendations.youtubeSearchDisabled) {\n\t\t\t\tbuf += Utils.escapeHTML(trackName);\n\t\t\t} else {\n\t\t\t\tbuf += `<a href=\"https://youtu.be/${videoIDs![0]}\">${Utils.escapeHTML(trackName)}</a>`;\n\t\t\t}\n\t\t\tbuf += `</td></tr></table>${this.getScrobbleBadge()}`;\n\t\t}\n\t\treturn buf;\n\t}\n\n\taddAccountName(userid: ID, accountName: string) {\n\t\tthis.checkHasKey();\n\t\taccountName = accountName.trim();\n\t\tif (lastfm[userid]) {\n\t\t\tconst oldName = lastfm[userid];\n\t\t\tlastfm[userid] = accountName;\n\t\t\tsaveLastFM();\n\t\t\treturn `last.fm account name changed from '${oldName}' to '${accountName}'.`;\n\t\t}\n\t\tlastfm[userid] = accountName;\n\t\tsaveLastFM();\n\t\treturn `Registered last.fm account '${accountName}'.`;\n\t}\n\n\tvalidateAccountName(accountName: string) {\n\t\taccountName = accountName.trim();\n\t\tconst sanitizedName = accountName.replace(/[^-_a-zA-Z0-9]+/g, '');\n\t\tif (!(!accountName.includes(' ') && accountName === sanitizedName && /^[a-zA-Z]/.test(sanitizedName) &&\n\t\t\tsanitizedName.length > 1 && sanitizedName.length < 16)) {\n\t\t\tthrow new Chat.ErrorMessage(`The provided account name (${sanitizedName}) is invalid. Valid last.fm usernames are between 2-15 characters, start with a letter, and only contain letters, numbers, hyphens, and underscores.`);\n\t\t}\n\t\treturn true;\n\t}\n\n\tgetAccountName(username: string) {\n\t\tif (lastfm[toID(username)]) return lastfm[toID(username)];\n\t\treturn username.trim().replace(/ /g, '_').replace(/[^-_a-zA-Z0-9]/g, '');\n\t}\n\n\tasync tryGetTrackData(track: string, artist?: string) {\n\t\tthis.checkHasKey();\n\t\tconst query: { [k: string]: any } = {\n\t\t\tmethod: 'track.search', limit: 1, api_key: Config.lastfmkey, track, format: 'json',\n\t\t};\n\t\tif (artist) query.artist = artist;\n\t\tlet raw;\n\t\ttry {\n\t\t\traw = await Net(API_ROOT).get({ query });\n\t\t} catch {\n\t\t\tthrow new Chat.ErrorMessage(`No track data found.`);\n\t\t}\n\t\tconst req = JSON.parse(raw);\n\t\tlet buf = ``;\n\t\tif (req.results?.trackmatches?.track?.length) {\n\t\t\tbuf += `<table><tr><td style=\"padding-right:5px\">`;\n\t\t\tconst obj = req.results.trackmatches.track[0];\n\t\t\tconst trackName = obj.name || \"Untitled\";\n\t\t\tconst artistName = obj.artist || \"Unknown Artist\";\n\t\t\tconst searchName = `${artistName} - ${trackName}`;\n\t\t\tif (obj.image?.length) {\n\t\t\t\tconst img = obj.image;\n\t\t\t\tconst imageIndex = img.length >= 3 ? 2 : img.length - 1;\n\t\t\t\tif (img[imageIndex]['#text'] && !DEFAULT_IMAGES.includes(img[imageIndex]['#text'])) {\n\t\t\t\t\tbuf += `<img src=\"${img[imageIndex]['#text']}\" width=\"75\" height=\"75\" />`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuf += `</td><td>`;\n\t\t\tconst artistUrl = obj.url.split('_/')[0];\n\t\t\tbuf += `<strong><a href=\"${artistUrl}\">${artistName}</a> - <a href=\"${obj.url}\">${trackName}</a></strong><br />`;\n\t\t\tlet videoIDs: string[] | undefined;\n\t\t\ttry {\n\t\t\t\tvideoIDs = await YouTube.searchVideo(searchName, 1);\n\t\t\t} catch (e: any) {\n\t\t\t\tif (!recommendations.youtubeSearchDisabled) {\n\t\t\t\t\tthrow new Chat.ErrorMessage(`Error while fetching video data: ${e.message}`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!videoIDs?.length || recommendations.youtubeSearchDisabled) {\n\t\t\t\tbuf += searchName;\n\t\t\t} else {\n\t\t\t\tbuf += `<a href=\"https://youtu.be/${videoIDs[0]}\">YouTube link</a>`;\n\t\t\t}\n\t\t\tbuf += `</td></tr></table>${this.getScrobbleBadge()}`;\n\t\t}\n\t\tif (req.error) {\n\t\t\tthrow new Chat.ErrorMessage(`${req.message}.`);\n\t\t}\n\t\tif (!buf) {\n\t\t\tthrow new Chat.ErrorMessage(`No results for '${artist ? `${artist} - ` : ``}${track}' found. Check spelling?`);\n\t\t}\n\t\treturn buf;\n\t}\n\tcheckHasKey() {\n\t\tif (!Config.lastfmkey) {\n\t\t\tthrow new Chat.ErrorMessage(`This server does not support last.fm commands. If you're the owner, you can enable them by setting up Config.lastfmkey.`);\n\t\t}\n\t}\n\tgetScrobbleBadge() {\n\t\treturn `<div class=\"gray\" style=\"float:right;font-size:8pt\">[powered by AudioScrobbler]</div><div style=\"clear:both\"></div>`;\n\t}\n}\n\nclass RecommendationsInterface {\n\tgetRandomRecommendation() {\n\t\tconst recs = recommendations.saved;\n\t\treturn recs[Math.floor(Math.random() * recs.length)];\n\t}\n\n\tasync add(\n\t\tartist: string, title: string, url: string, description: string,\n\t\tusername: string, tags: string[], avatar?: string\n\t) {\n\t\tartist = artist.trim();\n\t\ttitle = title.trim();\n\t\tif (this.get(artist, title)) {\n\t\t\tthrow new Chat.ErrorMessage(`The song titled '${title}' by ${artist} is already recommended.`);\n\t\t}\n\t\tif (!/^https?:\\/\\//.test(url)) url = `https://${url}`;\n\t\tif (!YouTube.linkRegex.test(url)) {\n\t\t\tthrow new Chat.ErrorMessage(`Please provide a valid YouTube link.`);\n\t\t}\n\t\turl = url.split('~')[0];\n\t\tconst videoInfo = await YouTube.getVideoData(url);\n\t\tthis.checkTags(tags);\n\t\t// JUST in case\n\t\tif (!recommendations.saved) recommendations.saved = [];\n\t\tconst rec: Recommendation = {\n\t\t\tartist, title, videoInfo, url, description, tags, userData: { name: username }, likes: 0,\n\t\t};\n\t\tif (!rec.tags.map(toID).includes(toID(username))) rec.tags.push(username);\n\t\tif (!rec.tags.map(toID).includes(toID(artist))) rec.tags.push(artist);\n\t\tif (avatar) rec.userData.avatar = avatar;\n\t\trecommendations.saved.push(rec);\n\t\tsaveRecommendations();\n\t}\n\n\tdelete(artist: string, title: string) {\n\t\tartist = artist.trim();\n\t\ttitle = title.trim();\n\t\tif (!recommendations.saved?.length) {\n\t\t\tthrow new Chat.ErrorMessage(`The song titled '${title}' by ${artist} isn't recommended.`);\n\t\t}\n\t\tconst recIndex = this.getIndex(artist, title);\n\t\tif (recIndex < 0) {\n\t\t\tthrow new Chat.ErrorMessage(`The song titled '${title}' by ${artist} isn't recommended.`);\n\t\t}\n\t\trecommendations.saved.splice(recIndex, 1);\n\t\tsaveRecommendations();\n\t}\n\n\tasync suggest(\n\t\tartist: string, title: string, url: string, description: string,\n\t\tusername: string, tags: string[], avatar?: string\n\t) {\n\t\tartist = artist.trim();\n\t\ttitle = title.trim();\n\t\tif (this.get(artist, title)) {\n\t\t\tthrow new Chat.ErrorMessage(`The song titled '${title}' by ${artist} is already recommended.`);\n\t\t}\n\t\tif (this.get(artist, title, null, true)) {\n\t\t\tthrow new Chat.ErrorMessage(`The song titled '${title}' by ${artist} is already suggested.`);\n\t\t}\n\t\tif (!/^https?:\\/\\//.test(url)) url = `https://${url}`;\n\t\tif (!YouTube.linkRegex.test(url)) {\n\t\t\tthrow new Chat.ErrorMessage(`Please provide a valid YouTube link.`);\n\t\t}\n\t\turl = url.split('~')[0];\n\t\tconst videoInfo = await YouTube.getVideoData(url);\n\t\tthis.checkTags(tags);\n\t\tconst rec: Recommendation = {\n\t\t\tartist, title, videoInfo, url, description, tags, userData: { name: username }, likes: 0,\n\t\t};\n\t\tif (!rec.tags.map(toID).includes(toID(username))) rec.tags.push(username);\n\t\tif (!rec.tags.map(toID).includes(toID(artist))) rec.tags.push(artist);\n\t\tif (avatar) rec.userData.avatar = avatar;\n\t\trecommendations.suggested.push(rec);\n\t\tsaveRecommendations();\n\t}\n\n\tapproveSuggestion(submitter: string, artist: string, title: string) {\n\t\tartist = artist.trim();\n\t\ttitle = title.trim();\n\t\tconst rec = this.get(artist, title, submitter, true);\n\t\tif (!rec) {\n\t\t\tthrow new Chat.ErrorMessage(`There is no song titled '${title}' by ${artist} suggested from ${submitter.trim()}.`);\n\t\t}\n\t\tif (!recommendations.saved) recommendations.saved = [];\n\t\trecommendations.saved.push(rec);\n\t\trecommendations.suggested.splice(recommendations.suggested.indexOf(rec), 1);\n\t\tsaveRecommendations();\n\t}\n\n\tdenySuggestion(submitter: string, artist: string, title: string) {\n\t\tartist = artist.trim();\n\t\ttitle = title.trim();\n\t\tconst index = this.getIndex(artist, title, submitter, true);\n\t\tif (index < 0) {\n\t\t\tthrow new Chat.ErrorMessage(`There is no song titled '${title}' by ${artist} suggested from ${submitter.trim()}.`);\n\t\t}\n\t\trecommendations.suggested.splice(index, 1);\n\t\tsaveRecommendations();\n\t}\n\n\tasync render(rec: Recommendation, suggested = false) {\n\t\tlet buf = ``;\n\t\tbuf += `<div style=\"color:#000;background:linear-gradient(rgba(210,210,210),rgba(225,225,225))\">`;\n\t\tbuf += `<table style=\"margin:auto;background:rgba(255,255,255,0.25);padding:3px;\"><tbody><tr>`;\n\t\tif (!rec.videoInfo) {\n\t\t\t// eslint-disable-next-line require-atomic-updates\n\t\t\trec.videoInfo = await YouTube.getVideoData(YouTube.getId(rec.url));\n\t\t\tsaveRecommendations();\n\t\t}\n\t\tif (rec.videoInfo) {\n\t\t\tbuf += `<td style=\"text-align:center;\"><img src=\"${rec.videoInfo.thumbnail}\" width=\"120\" height=\"67\" /><br />`;\n\t\t\tbuf += `<small><em>${!suggested ? `${Chat.count(rec.likes, \"points\")} | ` : ``}${rec.videoInfo.views} views</em></small></td>`;\n\t\t}\n\t\tbuf += Utils.html`<td style=\"max-width:300px\"><a href=\"${rec.url}\" style=\"color:#000;font-weight:bold;\">${rec.artist} - ${rec.title}</a>`;\n\t\tconst tags = rec.tags.map(x => Utils.escapeHTML(x))\n\t\t\t.filter(x => toID(x) !== toID(rec.userData.name) && toID(x) !== toID(rec.artist));\n\t\tif (tags.length) {\n\t\t\tbuf += `<br /><strong>Tags:</strong> <em>${tags.join(', ')}</em>`;\n\t\t}\n\t\tif (rec.description) {\n\t\t\tbuf += `<br /><span style=\"display:inline-block;line-height:1.15em;\"><strong>Description:</strong> ${Utils.escapeHTML(rec.description)}</span>`;\n\t\t}\n\t\tif (!rec.videoInfo && !suggested) {\n\t\t\tbuf += `<br /><strong>Score:</strong> ${Chat.count(rec.likes, \"points\")}`;\n\t\t}\n\t\tif (!rec.userData.avatar) {\n\t\t\tbuf += `<br /><strong>Recommended by:</strong> ${rec.userData.name}`;\n\t\t}\n\t\tbuf += `<hr />`;\n\t\tif (suggested) {\n\t\t\tbuf += Utils.html`<button class=\"button\" name=\"send\" value=\"/msgroom thestudio,/approvesuggestion ${rec.userData.name}|${rec.artist}|${rec.title}\">Approve</button> | `;\n\t\t\tbuf += Utils.html`<button class=\"button\" name=\"send\" value=\"/msgroom thestudio,/denysuggestion ${rec.userData.name}|${rec.artist}|${rec.title}\">Deny</button>`;\n\t\t} else {\n\t\t\tbuf += Utils.html`<button class=\"button\" name=\"send\" value=\"/msgroom thestudio,/likerec ${rec.artist}|${rec.title}\" style=\"float:right;display:inline;padding:3px 5px;font-size:8pt;\">`;\n\t\t\tbuf += `<img src=\"https://${Config.routes.client}/sprites/bwicons/441.png\" style=\"margin:-9px 0 -6px -7px;\" width=\"32\" height=\"32\" />`;\n\t\t\tbuf += `<span style=\"position:relative;bottom:2.6px;\">Upvote</span></button>`;\n\t\t}\n\t\tbuf += `</td>`;\n\t\tif (rec.userData.avatar) {\n\t\t\tbuf += `<td style=\"text-align:center;width:110px;background:rgba(255,255,255,0.4);border-radius:15px;\">`;\n\t\t\tconst isCustom = rec.userData.avatar.startsWith('#');\n\t\t\tbuf += `<img style=\"margin-bottom:-38px;\" src=\"https://${Config.routes.client}/sprites/trainers${isCustom ? '-custom' : ''}/${isCustom ? rec.userData.avatar.slice(1) : rec.userData.avatar}.png\" width=\"80\" height=\"80\" />`;\n\t\t\tbuf += `<br /><span style=\"background:rgba(0,0,0,0.5);padding:1.5px 4px;color:white;font-size:7pt;\">Recommended by:`;\n\t\t\tbuf += `<br /><strong>${rec.userData.name}</strong></span></td>`;\n\t\t} else {\n\t\t\tbuf += `<td><span style=\"background:rgba(0,0,0,0.5);padding:1.5px 4px;color:white;font-size:7pt;\">Recommended by: <strong>${rec.userData.name}</strong></span></td>`;\n\t\t}\n\t\tbuf += `</tbody></table>`;\n\t\tbuf += `</div>`;\n\t\treturn buf;\n\t}\n\n\tlikeRecommendation(artist: string, title: string, liker: User) {\n\t\tconst rec = this.get(artist, title);\n\t\tif (!rec) {\n\t\t\tthrow new Chat.ErrorMessage(`The song titled '${title}' by ${artist} isn't recommended.`);\n\t\t}\n\t\tif (!rec.liked) {\n\t\t\trec.liked = { ips: [], userids: [] };\n\t\t}\n\t\tif ((!Config.noipchecks && rec.liked.ips.includes(liker.latestIp)) || rec.liked.userids.includes(liker.id)) {\n\t\t\tthrow new Chat.ErrorMessage(`You've already liked this recommendation.`);\n\t\t}\n\t\trec.likes++;\n\t\trec.liked.ips.push(liker.latestIp);\n\t\trec.liked.userids.push(liker.id);\n\t\tsaveRecommendations();\n\t}\n\n\tget(artist: string, title: string, submitter: string | null = null, fromSuggestions = false) {\n\t\tlet recs = recommendations.saved;\n\t\tif (fromSuggestions) recs = recommendations.suggested;\n\t\treturn recs.find(x => (\n\t\t\ttoID(x.artist) === toID(artist) &&\n\t\t\ttoID(x.title) === toID(title) &&\n\t\t\t(!submitter || toID(x.userData.name) === toID(submitter))\n\t\t));\n\t}\n\n\tgetIndex(artist: string, title: string, submitter: string | null = null, fromSuggestions = false) {\n\t\tlet recs = recommendations.saved;\n\t\tif (fromSuggestions) recs = recommendations.suggested;\n\t\treturn recs.findIndex(x => (\n\t\t\ttoID(x.artist) === toID(artist) &&\n\t\t\ttoID(x.title) === toID(title) &&\n\t\t\t(!submitter || toID(x.userData.name) === toID(submitter))\n\t\t));\n\t}\n\n\tcheckTags(tags: string[]) {\n\t\tconst cleansedTags = new Set<ID>();\n\t\tfor (const tag of tags) {\n\t\t\tif (!toID(tag)) throw new Chat.ErrorMessage(`Empty tag detected.`);\n\t\t\tif (cleansedTags.has(toID(tag))) {\n\t\t\t\tthrow new Chat.ErrorMessage(`Duplicate tag: ${tag.trim()}`);\n\t\t\t}\n\t\t\tcleansedTags.add(toID(tag));\n\t\t}\n\t}\n}\n\nexport const LastFM = new LastFMInterface();\nexport const Recs = new RecommendationsInterface();\n\nexport const commands: Chat.ChatCommands = {\n\tlastfmyoutubesearch(target, room, user) {\n\t\tthis.checkCan('gdeclare');\n\t\ttarget = toID(target);\n\t\tif (!target || !['enable', 'disable'].includes(target)) {\n\t\t\treturn this.parse('/help lastfmyoutubesearch');\n\t\t}\n\t\tif (target === 'enable') {\n\t\t\tif (!recommendations.youtubeSearchDisabled) {\n\t\t\t\tthrow new Chat.ErrorMessage(`The YouTube API is already enabled for Last.fm commands.`);\n\t\t\t}\n\t\t\tdelete recommendations.youtubeSearchDisabled;\n\t\t\tsaveRecommendations();\n\t\t\tthis.sendReply(`YouTube API enabled for Last.fm commands.`);\n\t\t\tthis.globalModlog(`LASTFM YOUTUBE API`, null, 'enabled');\n\t\t} else {\n\t\t\tif (recommendations.youtubeSearchDisabled) {\n\t\t\t\tthrow new Chat.ErrorMessage(`The YouTube API is already disabled for Last.fm commands.`);\n\t\t\t}\n\t\t\trecommendations.youtubeSearchDisabled = true;\n\t\t\tsaveRecommendations();\n\t\t\tthis.sendReply(`YouTube API disabled for Last.fm commands.`);\n\t\t\tthis.globalModlog(`LASTFM YOUTUBE API`, null, 'disabled');\n\t\t}\n\t},\n\tlastfmyoutubesearchhelp: [\n\t\t'/lastfmyoutubesearch [enable|disable] - Enables/disables the YouTube API for Last.fm commands. Requires: ~',\n\t],\n\tregisterlastfm(target, room, user) {\n\t\tif (!target) return this.parse(`/help registerlastfm`);\n\t\tthis.checkChat(target);\n\t\ttarget = this.filter(target) || '';\n\t\tif (!target) {\n\t\t\tthrow new Chat.ErrorMessage(`The provided account name has phrases that PS doesn't allow.`);\n\t\t}\n\t\tLastFM.validateAccountName(target);\n\t\tthis.sendReply(LastFM.addAccountName(user.id, target.trim()));\n\t},\n\tregisterlastfmhelp: [\n\t\t`/registerlastfm [username] - Adds the provided [username] to the last.fm database for scrobbling.`,\n\t\t`Usernames can only be 2-15 characters long, must start with a letter, and can only contain letters, numbers, hyphens, and underscores.`,\n\t],\n\n\tasync lastfm(target, room, user) {\n\t\tthis.checkChat();\n\t\tif (!user.autoconfirmed) throw new Chat.ErrorMessage(`You cannot use this command while not autoconfirmed.`);\n\t\tthis.runBroadcast(true);\n\t\tconst targetUsername = this.splitUser(target).targetUsername || (user.named ? user.name : '');\n\t\tconst username = LastFM.getAccountName(targetUsername);\n\t\tthis.sendReplyBox(await LastFM.getScrobbleData(username, targetUsername));\n\t},\n\tlastfmhelp: [\n\t\t`/lastfm [username] - Displays the last scrobbled song for the person using the command or for [username] if provided.`,\n\t\t`To link up your last.fm account, check out \"/help registerlastfm\".`,\n\t],\n\n\tasync track(target, room, user) {\n\t\tif (!target) return this.parse('/help track');\n\t\tthis.checkChat();\n\t\tif (!user.autoconfirmed) throw new Chat.ErrorMessage(`You cannot use this command while not autoconfirmed.`);\n\t\tconst [track, artist] = this.splitOne(target);\n\t\tif (!track) return this.parse('/help track');\n\t\tthis.runBroadcast(true);\n\t\tthis.sendReplyBox(await LastFM.tryGetTrackData(track, artist || undefined));\n\t},\n\ttrackhelp: [\n\t\t`/track [song name], [artist] - Displays the most relevant search result to the song name (and artist if specified) provided.`,\n\t],\n\n\taddrec: 'addrecommendation',\n\tasync addrecommendation(target, room, user) {\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tthis.checkCan('show', null, room);\n\t\tconst [artist, title, url, description, ...tags] = target.split('|').map(x => x.trim());\n\t\tif (!(artist && title && url && description && tags?.length)) {\n\t\t\treturn this.parse(`/help addrecommendation`);\n\t\t}\n\n\t\tconst cleansedTags = tags.map(x => x.trim());\n\t\tawait Recs.add(artist, title, url, description, user.name, cleansedTags, String(user.avatar));\n\n\t\tthis.privateModAction(`${user.name} added a recommendation for '${title}' by ${artist}.`);\n\t\tthis.modlog(`RECOMMENDATION`, null, `add: '${toID(title)}' by ${toID(artist)}`);\n\t},\n\taddrecommendationhelp: [\n\t\t`/addrecommendation artist | song title | url | description | tag1 | tag2 | ... - Adds a song recommendation. Requires: + % @ * # ~`,\n\t],\n\n\tdelrec: 'removerecommendation',\n\tremoverecommendation(target, room, user) {\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tconst [artist, title] = target.split(`|`).map(x => x.trim());\n\t\tif (!(artist && title)) return this.parse(`/help removerecommendation`);\n\t\tconst rec = Recs.get(artist, title);\n\t\tif (!rec) throw new Chat.ErrorMessage(`Recommendation not found.`);\n\t\tif (toID(rec.userData.name) !== user.id) {\n\t\t\tthis.checkCan('mute', null, room);\n\t\t}\n\n\t\tRecs.delete(artist, title);\n\n\t\tthis.privateModAction(`${user.name} removed a recommendation for '${title}' by ${artist}.`);\n\t\tthis.modlog(`RECOMMENDATION`, null, `remove: '${toID(title)}' by ${toID(artist)}`);\n\t},\n\tremoverecommendationhelp: [\n\t\t`/removerecommendation artist | song title - Removes a song recommendation. Requires: % @ * # ~`,\n\t\t`If you added a recommendation, you can remove it on your own without being one of the required ranks.`,\n\t],\n\n\tsuggestrec: 'suggestrecommendation',\n\tasync suggestrecommendation(target, room, user) {\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tif (!target) {\n\t\t\treturn this.parse('/help suggestrecommendation');\n\t\t}\n\t\tthis.checkChat(target);\n\t\tif (!user.autoconfirmed) throw new Chat.ErrorMessage(`You cannot use this command while not autoconfirmed.`);\n\t\tconst [artist, title, url, description, ...tags] = target.split('|').map(x => x.trim());\n\t\tif (!(artist && title && url && description && tags?.length)) {\n\t\t\treturn this.parse(`/help suggestrecommendation`);\n\t\t}\n\n\t\tconst cleansedTags = tags.map(x => x.trim());\n\t\tawait Recs.suggest(artist, title, url, description, user.name, cleansedTags, String(user.avatar));\n\t\tthis.sendReply(`Your suggestion for '${title}' by ${artist} has been submitted.`);\n\t\tconst html = await Recs.render({\n\t\t\tartist, title, url, description,\n\t\t\tuserData: { name: user.name, avatar: String(user.avatar) },\n\t\t\ttags: cleansedTags, likes: 0, videoInfo: null,\n\t\t}, true);\n\t\troom.sendRankedUsers(`|html|${html}`, '%');\n\t},\n\tsuggestrecommendationhelp: [\n\t\t`/suggestrecommendation artist | song title | url | description | tag1 | tag2 | ... - Suggest a song recommendation.`,\n\t],\n\n\tapprovesuggestion(target, room, user) {\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tthis.checkCan('mute', null, room);\n\t\tconst [submitter, artist, title] = target.split('|').map(x => x.trim());\n\t\tif (!(submitter && artist && title)) return this.parse(`/help approvesuggestion`);\n\n\t\tRecs.approveSuggestion(submitter, artist, title);\n\n\t\tthis.privateModAction(`${user.name} approved a suggested recommendation from ${submitter} for '${title}' by ${artist}.`);\n\t\tthis.modlog(`RECOMMENDATION`, null, `approve: '${toID(title)}' by ${toID(artist)} from ${submitter}`);\n\t},\n\tapprovesuggestionhelp: [\n\t\t`/approvesuggestion submitter | artist | strong title - Approve a submitted song recommendation. Requires: % @ * # ~`,\n\t],\n\n\tdenysuggestion(target, room, user) {\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tthis.checkCan('mute', null, room);\n\t\tconst [submitter, artist, title] = target.split('|').map(x => x.trim());\n\t\tif (!(submitter && artist && title)) return this.parse(`/help approvesuggestion`);\n\n\t\tRecs.denySuggestion(submitter, artist, title);\n\n\t\tthis.privateModAction(`${user.name} denied a suggested recommendation from ${submitter} for '${title}' by ${artist}.`);\n\t\tthis.modlog(`RECOMMENDATION`, null, `deny: '${toID(title)}' by ${toID(artist)} from ${submitter}`);\n\t},\n\tdenysuggestionhelp: [\n\t\t`/denysuggestion submitter | artist | strong title - Deny a submitted song recommendation. Requires: % @ * # ~`,\n\t],\n\n\trec: 'recommendation',\n\tsearchrec: 'recommendation',\n\tviewrec: 'recommendation',\n\tsearchrecommendation: 'recommendation',\n\tviewrecommendation: 'recommendation',\n\trandrec: 'recommendation',\n\trandomrecommendation: 'recommendation',\n\tasync recommendation(target, room, user) {\n\t\tif (!recommendations.saved.length) {\n\t\t\tthrow new Chat.ErrorMessage(`There are no recommendations saved.`);\n\t\t}\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tthis.runBroadcast();\n\t\tif (!target) {\n\t\t\treturn this.sendReply(`|html|${await Recs.render(Recs.getRandomRecommendation())}`);\n\t\t}\n\t\tconst matches: Recommendation[] = [];\n\t\ttarget = target.slice(0, 300);\n\t\tconst args = target.split(',');\n\t\tfor (const rec of recommendations.saved) {\n\t\t\tif (!args.every(x => rec.tags.map(toID).includes(toID(x)))) continue;\n\t\t\tmatches.push(rec);\n\t\t}\n\t\tif (!matches.length) {\n\t\t\tthrow new Chat.ErrorMessage(`No matches found.`);\n\t\t}\n\t\tconst sample = Utils.shuffle(matches)[0];\n\t\tthis.sendReply(`|html|${await Recs.render(sample)}`);\n\t},\n\trecommendationhelp: [\n\t\t`/recommendation [key1, key2, key3, ...] - Displays a random recommendation that matches all keys, if one exists.`,\n\t\t`If no arguments are provided, a random recommendation is shown.`,\n\t\t`/addrecommendation artist | song title | url | description | tag1 | tag2 | ... - Adds a song recommendation. Requires: + % @ * # ~`,\n\t\t`/removerecommendation artist | song title - Removes a song recommendation. Requires: % @ * # ~`,\n\t\t`If you added a recommendation, you can remove it on your own without being one of the required ranks.`,\n\t\t`/suggestrecommendation artist | song title | url | description | tag1 | tag2 | ... - Suggest a song recommendation.`,\n\t],\n\n\tlikerec: 'likerecommendation',\n\tlikerecommendation(target, room, user, connection) {\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tconst [artist, title] = target.split('|').map(x => x.trim());\n\t\tif (!(artist && title)) return this.parse(`/help likerecommendation`);\n\t\tRecs.likeRecommendation(artist, title, user);\n\t\tthis.sendReply(`You liked '${title}' by ${artist}.`);\n\t},\n\tlikerecommendationhelp: [\n\t\t`/likerecommendation artist | title - Upvotes a recommendation for the provided artist and title.`,\n\t],\n\n\tviewrecs: 'viewrecommendations',\n\tviewrecommendations(target, room, user) {\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tthis.parse(`/j view-recommendations-${room.roomid}`);\n\t},\n\tviewrecommendationshelp: [\n\t\t`/viewrecommendations OR /viewrecs - View all recommended songs.`,\n\t],\n\n\tviewsuggestions: 'viewsuggestedrecommendations',\n\tviewsuggestedrecs: 'viewsuggestedrecommendations',\n\tviewsuggestedrecommendations(target, room, user) {\n\t\troom = this.requireRoom('thestudio' as RoomID);\n\t\tthis.parse(`/j view-suggestedrecommendations-${room.roomid}`);\n\t},\n\tviewsuggestedrecommendationshelp: [\n\t\t`/viewsuggestedrecommendations OR /viewsuggestions - View all suggested recommended songs. Requires: % @ * # ~`,\n\t],\n};\n\nexport const pages: Chat.PageTable = {\n\tasync recommendations(query, user, connection) {\n\t\tconst room = this.requireRoom();\n\t\tthis.checkCan('mute', null, room);\n\t\tif (!user.inRooms.has(room.roomid)) throw new Chat.ErrorMessage(`You must be in ${room.title} to view this page.`);\n\t\tthis.title = 'Recommendations';\n\t\tlet buf = `<div class=\"pad\">`;\n\t\tbuf += `<button style=\"float:right\" class=\"button\" name=\"send\" value=\"/j view-recommendations-${room.roomid}\"><i class=\"fa fa-refresh\"></i> Refresh</button>`;\n\t\tconst recs = recommendations.saved;\n\t\tif (!recs?.length) {\n\t\t\treturn `${buf}<h2>There are currently no recommendations.</h2></div>`;\n\t\t}\n\t\tbuf += `<h2>Recommendations (${recs.length}):</h2>`;\n\t\tfor (const rec of recs) {\n\t\t\tbuf += `<div class=\"infobox\">`;\n\t\t\tbuf += await Recs.render(rec);\n\t\t\tif (user.can('mute', null, room) || toID(rec.userData.name) === user.id) {\n\t\t\t\tbuf += `<hr /><button class=\"button\" name=\"send\" value=\"/msgroom thestudio,/removerecommendation ${rec.artist}|${rec.title}\">Delete</button>`;\n\t\t\t}\n\t\t\tbuf += `</div>`;\n\t\t}\n\t\treturn buf;\n\t},\n\tasync suggestedrecommendations(query, user, connection) {\n\t\tconst room = this.requireRoom();\n\t\tthis.checkCan('mute', null, room);\n\t\tif (!user.inRooms.has(room.roomid)) throw new Chat.ErrorMessage(`You must be in ${room.title} to view this page.`);\n\t\tthis.title = 'Suggested Recommendations';\n\t\tlet buf = `<div class=\"pad\">`;\n\t\tbuf += `<button style=\"float:right\" class=\"button\" name=\"send\" value=\"/j view-suggestedrecommendations-${room.roomid}\"><i class=\"fa fa-refresh\"></i> Refresh</button>`;\n\t\tconst recs = recommendations.suggested;\n\t\tif (!recs?.length) {\n\t\t\treturn `${buf}<h2>There are currently no suggested recommendations.</h2></div>`;\n\t\t}\n\t\tbuf += `<h2>Suggested Recommendations (${recs.length}):</h2>`;\n\t\tfor (const rec of recs) {\n\t\t\tbuf += `<div class=\"infobox\">`;\n\t\t\tbuf += await Recs.render(rec, true);\n\t\t\tbuf += `</div>`;\n\t\t}\n\t\treturn buf;\n\t},\n};\n"],
  "mappings": "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",
  "names": []
}

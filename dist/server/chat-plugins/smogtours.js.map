{
  "version": 3,
  "sources": ["../../../server/chat-plugins/smogtours.ts"],
  "sourcesContent": ["/**\n * Integration for Smogon tournaments.\n * @author mia-pi-git\n */\nimport { FS, Utils } from '../../lib';\nimport type { Tournament } from '../tournaments';\n\ntype Image = [string, number, number];\ninterface TourEvent {\n\ttitle: string;\n\turl: string;\n\tdesc: string;\n\timage?: Image;\n\t/** If there's an image, there needs to be credit to wherever they got it */\n\tartistCredit?: { url: string, name: string };\n\tid: string;\n\tshortDesc: string;\n\tdate: number;\n\t// make this required later\n\tends?: number;\n}\n\ninterface TourTable {\n\ttitle: string;\n\ttours: TourEvent[];\n\twhitelist?: string[];\n\ticon?: Image;\n\tdesc: string;\n}\n\nexport const tours: Record<string, TourTable> = {\n\tofficial: {\n\t\ttitle: \"Smogon Officials\",\n\t\t// cap this one's dimensions\n\t\ticon: ['https://www.smogon.com/media/zracknel-beta.svg', 178, 200],\n\t\ttours: [],\n\t\tdesc: \"Tournaments run by Smogon staff.\",\n\t},\n\tsmogon: {\n\t\ttitle: \"Open Sign-Ups\",\n\t\ttours: [],\n\t\tdesc: \"Tournaments run by Smogon staff and regular users alike.\",\n\t},\n\tps: {\n\t\ttitle: \"Pok\u00E9mon Showdown!\",\n\t\ticon: ['https://play.pokemonshowdown.com/favicon-256.png', 196, 196],\n\t\ttours: [],\n\t\tdesc: \"Tournaments run by the rooms of Pokemon Showdown.\",\n\t},\n};\ntry {\n\tconst data = JSON.parse(FS('config/chat-plugins/smogtours.json').readSync());\n\t// settings should prioritize hardcoded values for these keys\n\tconst PRIO = ['title', 'icon'];\n\tfor (const key in data) {\n\t\tconst section = (tours[key] ||= data[key]) as any;\n\t\tfor (const k in data[key]) {\n\t\t\tif (PRIO.includes(k)) {\n\t\t\t\tif (!section[k]) section[k] = data[key][k];\n\t\t\t} else {\n\t\t\t\tsection[k] = data[key][k];\n\t\t\t}\n\t\t}\n\t}\n} catch {}\n\nfunction saveTours() {\n\tFS('config/chat-plugins/smogtours.json').writeUpdate(() => JSON.stringify(tours));\n}\n\nfunction getTour(categoryID: ID, id: string) {\n\tid = toID(id);\n\tif (!tours[categoryID]) return null;\n\tconst idx = tours[categoryID].tours.findIndex(f => f.id === id) ?? -1;\n\tconst tour = tours[categoryID].tours[idx];\n\tif (!tour) {\n\t\treturn null;\n\t}\n\tif (tour.ends && Date.now() > tour.ends) {\n\t\ttours[categoryID].tours.splice(idx, 1);\n\t\treturn null;\n\t}\n\treturn tour;\n}\n\nfunction checkWhitelisted(category: ID, user: User) {\n\treturn category ?\n\t\ttours[category].whitelist?.includes(user.id) :\n\t\tObject.values(tours).some(f => f.whitelist?.includes(user.id));\n}\n\nfunction checkCanEdit(user: User, context: Chat.PageContext | Chat.CommandContext, category?: ID) {\n\tcategory = toID(category);\n\tif (!checkWhitelisted(category, user)) {\n\t\tcontext.checkCan('rangeban');\n\t}\n}\n\nexport const commands: Chat.ChatCommands = {\n\tsmogtours: {\n\t\t''() {\n\t\t\treturn this.parse('/j view-tournaments-all');\n\t\t},\n\t\tedit: 'add',\n\t\tasync add(target, room, user, connection, cmd) {\n\t\t\tif (!toID(target).length) {\n\t\t\t\treturn this.parse(`/help smogtours`);\n\t\t\t}\n\t\t\tconst targets = target.split('|');\n\t\t\tconst isEdit = cmd === 'edit';\n\t\t\tconst tourID = isEdit ? toID(targets.shift()) : null;\n\t\t\t// {title}|{category}|{url}|{end date}|{img}|{credit}|{artist}{shortDesc}|{desc}\n\t\t\tconst [\n\t\t\t\ttitle, rawSection, url, rawEnds, rawImg, rawCredit, rawArtistName, rawShort, rawDesc,\n\t\t\t] = Utils.splitFirst(targets.join('|'), '|', 8).map(f => f.trim());\n\t\t\tconst sectionID = toID(rawSection);\n\t\t\tif (!toID(title)) {\n\t\t\t\treturn this.popupReply(`Invalid title. Must have at least one alphanumeric character.`);\n\t\t\t}\n\t\t\tconst section = tours[sectionID];\n\t\t\tif (!section) {\n\t\t\t\treturn this.popupReply(`Invalid section ID: \"${sectionID}\"`);\n\t\t\t}\n\t\t\tif (!isEdit && section.tours.find(f => toID(title) === f.id)) {\n\t\t\t\treturn this.popupReply(`A tour with that ID already exists. Please choose another.`);\n\t\t\t}\n\t\t\tcheckCanEdit(user, this, sectionID);\n\t\t\tif (!Chat.isLink(url)) {\n\t\t\t\treturn this.popupReply(`Invalid info URL: \"${url}\"`);\n\t\t\t}\n\t\t\tif (!/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(rawEnds)) {\n\t\t\t\treturn this.popupReply(`Invalid ending date: ${rawEnds}.`);\n\t\t\t}\n\t\t\tconst ends = new Date(rawEnds).getTime();\n\t\t\tif (isNaN(ends)) {\n\t\t\t\treturn this.popupReply(`Invalid ending date: ${rawEnds}.`);\n\t\t\t}\n\t\t\tlet image, artistCredit;\n\t\t\tif (rawImg) {\n\t\t\t\tif (!Chat.isLink(rawImg)) {\n\t\t\t\t\treturn this.popupReply(`Invalid image URL: ${rawImg}`);\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tconst dimensions = await Chat.fitImage(rawImg, 300, 300);\n\t\t\t\t\timage = [rawImg, ...dimensions.slice(0, -1)] as Image;\n\t\t\t\t} catch {\n\t\t\t\t\treturn this.popupReply(`Invalid image URL: ${rawImg}`);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (image && !(toID(rawCredit) && toID(rawArtistName))) {\n\t\t\t\treturn this.popupReply(`All images must have the artist named and a link to the profile of the user who created them.`);\n\t\t\t}\n\t\t\tif (rawCredit || rawArtistName) { // if one exists, both should, as verified above\n\t\t\t\tconst artistUrl = (Chat.linkRegex.exec(rawCredit))?.[0];\n\t\t\t\tif (!artistUrl) {\n\t\t\t\t\treturn this.popupReply(`Invalid artist credit URL.`);\n\t\t\t\t}\n\t\t\t\tartistCredit = { url: artistUrl, name: rawArtistName.trim() };\n\t\t\t}\n\t\t\tif (!rawShort?.length || !rawDesc?.length) {\n\t\t\t\treturn this.popupReply(`Must provide both a short description and a full description.`);\n\t\t\t}\n\t\t\tconst tour: TourEvent = {\n\t\t\t\ttitle: Utils.escapeHTML(title),\n\t\t\t\turl,\n\t\t\t\timage,\n\t\t\t\tartistCredit,\n\t\t\t\tshortDesc: rawShort.replace(/&#13;&#10;/g, '\\n'),\n\t\t\t\tdesc: rawDesc.replace(/&#13;&#10;/g, '\\n'),\n\t\t\t\tid: tourID || toID(title),\n\t\t\t\tdate: Date.now(),\n\t\t\t\tends,\n\t\t\t};\n\t\t\tif (isEdit) {\n\t\t\t\tconst index = section.tours.findIndex(t => t.id === tour.id);\n\t\t\t\tif (index < 0) {\n\t\t\t\t\treturn this.popupReply(`Tour not found. Create one first.`);\n\t\t\t\t}\n\t\t\t\tsection.tours.splice(index, 1);\n\t\t\t}\n\t\t\tsection.tours.push(tour);\n\t\t\tsaveTours();\n\t\t\tthis.refreshPage(`tournaments-add`);\n\t\t},\n\t\tend(target, room, user, connection) {\n\t\t\tconst [sectionID, tourID] = target.split(',').map(toID).filter(Boolean);\n\t\t\tif (!sectionID || !tourID) {\n\t\t\t\treturn this.parse(`/help smogtours`);\n\t\t\t}\n\t\t\tconst section = tours[sectionID];\n\t\t\tif (!section) return this.popupReply(`Invalid section: \"${sectionID}\"`);\n\t\t\tconst idx = section.tours.findIndex(t => t.id === tourID);\n\t\t\tconst title = section.tours[idx].title;\n\t\t\tif (idx < 0) {\n\t\t\t\treturn this.popupReply(`Tour with ID \"${tourID}\" not found.`);\n\t\t\t}\n\t\t\tsection.tours.splice(idx, 1);\n\t\t\tthis.refreshPage(`tournaments-view-${sectionID}-${tourID}`);\n\t\t\tthis.popupReply(`Tour \"${title}\" ended.`);\n\t\t},\n\t\twhitelist(target, room, user) {\n\t\t\tthis.checkCan('rangeban');\n\t\t\tconst [sectionID, targetID] = target.split(',').map(toID).filter(Boolean);\n\t\t\tif (!sectionID || !targetID) {\n\t\t\t\treturn this.parse(`/help smogtours`);\n\t\t\t}\n\t\t\tconst section = tours[sectionID];\n\t\t\tif (!section) {\n\t\t\t\tthrow new Chat.ErrorMessage(`Invalid section ID: \"${sectionID}\". Valid IDs: ${Object.keys(tours).join(', ')}`);\n\t\t\t}\n\t\t\tif (section.whitelist?.includes(targetID)) {\n\t\t\t\tthrow new Chat.ErrorMessage(`That user is already whitelisted on that section.`);\n\t\t\t}\n\t\t\tif (!section.whitelist) section.whitelist = [];\n\t\t\tsection.whitelist.push(targetID);\n\t\t\tthis.privateGlobalModAction(\n\t\t\t\t`${user.name} whitelisted ${targetID} to manage tours for the ${section.title} section`\n\t\t\t);\n\t\t\tthis.globalModlog('TOUR WHITELIST', targetID);\n\t\t\tsaveTours();\n\t\t},\n\t\tunwhitelist(target, room, user) {\n\t\t\tthis.checkCan('rangeban');\n\t\t\tconst [sectionID, targetID] = target.split(',').map(toID).filter(Boolean);\n\t\t\tif (!sectionID || !targetID) {\n\t\t\t\treturn this.parse(`/help smogtours`);\n\t\t\t}\n\t\t\tconst section = tours[sectionID];\n\t\t\tif (!section) {\n\t\t\t\tthrow new Chat.ErrorMessage(`Invalid section ID: \"${sectionID}\". Valid IDs: ${Object.keys(tours).join(', ')}`);\n\t\t\t}\n\t\t\tconst idx = section.whitelist?.indexOf(targetID) ?? -1;\n\t\t\tif (!section.whitelist || idx < 0) {\n\t\t\t\tthrow new Chat.ErrorMessage(`${targetID} is not whitelisted in that section.`);\n\t\t\t}\n\t\t\tsection.whitelist.splice(idx, 1);\n\t\t\tif (!section.whitelist.length) {\n\t\t\t\tdelete section.whitelist;\n\t\t\t}\n\t\t\tthis.privateGlobalModAction(\n\t\t\t\t`${user.name} removed ${targetID} from the tour management whitelist for the ${section.title} section`\n\t\t\t);\n\t\t\tthis.globalModlog('TOUR UNWHITELIST', targetID);\n\t\t\tsaveTours();\n\t\t},\n\t\tview() {\n\t\t\treturn this.parse(`/join view-tournaments-all`);\n\t\t},\n\t},\n\tsmogtourshelp: [\n\t\t`/smogtours view - View a list of ongoing forum tournaments.`,\n\t\t`/smogtours whitelist [section], [user] - Whitelists the given [user] to manage tournaments for the given [section].`,\n\t\t`Requires: ~`,\n\t\t`/smogtours unwhitelist [section], [user] - Removes the given [user] from the [section]'s management whitelist.`,\n\t\t`Requires: ~`,\n\t],\n};\n\n/** Modifies `inner` in-place to wrap it in the necessary HTML to show a tab on the sidebar. */\nfunction renderTab(inner: string, isLink?: string, isCur?: boolean) {\n\tlet buf = '';\n\tif (isLink && isCur) {\n\t\t// the CSS breaks entirely without the folderhacks.\n\t\tbuf += `<div class=\"folder cur\"><div class=\"folderhack3\"><div class=\"folderhack1\">`;\n\t\tbuf += `</div><div class=\"folderhack2\"></div>`;\n\t\tbuf += `<div class=\"selectFolder\">${inner}</div></div></div>`;\n\t} else {\n\t\tif (isLink) {\n\t\t\tinner = `<a class=\"selectFolder\" target=\"replace\" href=\"${isLink}\">${inner}</a>`;\n\t\t}\n\t\tbuf += `<div class=\"folder\">${inner}</div>`;\n\t}\n\treturn buf;\n}\n\nconst refresh = (pageid: string) => (\n\t`<button class=\"button\" name=\"send\" value=\"/join ${pageid}\" style=\"float: right\">` +\n\t`<i class=\"fa fa-refresh\"></i> Refresh</button>`\n);\n\nconst back = (section?: string) => (\n\t`<a class=\"button\" target=\"replace\" href=\"/view-tournaments-${section ? `section-${section}` : 'all'}\" style=\"float: left\">` +\n\t`<i class=\"fa fa-arrow-left\"></i> Back</a>`\n);\n\nexport function renderPageChooser(curPage: string, buffer: string, user?: User) {\n\tlet buf = `<div class=\"folderpane\">`;\n\tbuf += `<div class=\"folderlist\">`;\n\tbuf += `<div class=\"folderlistbefore\"></div>`;\n\n\tbuf += renderTab(\n\t\t`<strong>Home</strong>`,\n\t\t`view-tournaments-all`,\n\t\tcurPage === ''\n\t);\n\n\tconst keys = Object.keys(tours);\n\tbuf += keys.map(cat => {\n\t\tlet innerBuf = '';\n\t\tconst tourData = tours[cat];\n\t\tinnerBuf += renderTab(\n\t\t\t`<strong>${tourData.title}</strong>`,\n\t\t\t`view-tournaments-section-${cat}`,\n\t\t\tcurPage === cat\n\t\t);\n\t\tbuf += `<div class=\"foldersep\"></div>`;\n\t\tif (tourData.tours.length) {\n\t\t\tUtils.sortBy(tourData.tours, t => -t.date);\n\t\t\tinnerBuf += tourData.tours.map(t => (\n\t\t\t\trenderTab(\n\t\t\t\t\t`<i class=\"fa fa-trophy\"></i> ${t.title}`,\n\t\t\t\t\t`view-tournaments-view-${cat}-${t.id}`,\n\t\t\t\t\tcurPage === `${cat}-${t.id}`\n\t\t\t\t)\n\t\t\t)).join('');\n\t\t} else {\n\t\t\tinnerBuf += renderTab(`<div class=\"text\">None</div>`);\n\t\t}\n\t\treturn innerBuf;\n\t}).join('<div class=\"foldersep\"></div>');\n\tif (user && (checkWhitelisted('', user) || user?.can('rangeban'))) {\n\t\tbuf += `<div class=\"foldersep\"></div>`;\n\t\tbuf += renderTab(\n\t\t\t`<strong>Manage</strong>`, `view-tournaments-manage`, curPage === 'manage'\n\t\t);\n\t\tbuf += renderTab(\n\t\t\t`<i class=\"fa fa-pencil\"></i>Start new`,\n\t\t\t`view-tournaments-start`,\n\t\t\tcurPage === 'start',\n\t\t);\n\t\tbuf += renderTab(\n\t\t\t`<i class=\"fa fa-pencil\"></i>Edit existing`,\n\t\t\t`view-tournaments-edit`,\n\t\t\tcurPage === 'edit',\n\t\t);\n\t\tif (user.can('rangeban')) {\n\t\t\tbuf += renderTab(\n\t\t\t\t`<i class=\"fa fa-pencil\"></i>Whitelist`,\n\t\t\t\t`view-tournaments-whitelists`,\n\t\t\t\tcurPage === 'whitelist',\n\t\t\t);\n\t\t}\n\t}\n\n\tbuf += `<div class=\"folderlistafter\"></div></div></div><div class=\"teampane\">`;\n\tbuf += `${buffer}</div>`;\n\treturn buf;\n}\n\nfunction error(page: string, message: string, user: User) {\n\treturn renderPageChooser(page, `<div class=\"message-error\">${message}</div>`, user);\n}\n\nfunction instantTournaments() {\n\tconst roomTours = [];\n\tfor (const tourRoom of Rooms.rooms.values()) {\n\t\tconst tournament = tourRoom.game as Tournament;\n\t\tif (!tournament || tournament?.constructor.name !== 'Tournament') continue;\n\t\tif (tourRoom.settings.isPrivate || tourRoom.settings.isPersonal || tourRoom.settings.staffRoom) continue;\n\t\troomTours.push(tournament);\n\t}\n\tif (!roomTours.length) {\n\t\treturn `<p>No instant tournaments are currently running.</p>`;\n\t}\n\tconst started = Utils.sortBy(roomTours.filter(tour => tour.isTournamentStarted), tour => tour.room.roomid);\n\tconst signups = Utils.sortBy(roomTours.filter(tour => !tour.isTournamentStarted), tour => tour.room.roomid);\n\n\tfunction renderLink(tour: Tournament) {\n\t\tconst name = Dex.formats.get(tour.name).exists ? Dex.formats.get(tour.name).name : tour.name;\n\t\tconst icon = tour.generator.name === 'Round Robin' ? '<i class=\"fa fa-th\"></i>' :\n\t\t\ttour.generator.name === 'Single Elimination' ? '<i class=\"fa fa-share-alt\"></i>' :\n\t\t\t'<i class=\"fa fa-share-alt\"></i><i class=\"fa fa-share-alt\"></i>';\n\t\tconst plural = tour.players.length !== 1 ? 's' : '';\n\t\treturn `<li><a href=\"/${tour.room.roomid}\" class=\"blocklink\">&laquo;<strong>${tour.room.roomid}</strong>&raquo;<small style=\"float:right\">(${tour.players.length} player${plural})</small><br />${icon} <small>${Utils.escapeHTML(name)} ${tour.generator.name}</small></a></li>`;\n\t}\n\n\tlet buf = ``;\n\tif (signups.length) {\n\t\tbuf += `<strong>Accepting Signups:</strong><ul class=\"roomlist\">`;\n\t\tfor (const tour of signups) {\n\t\t\tbuf += renderLink(tour);\n\t\t}\n\t\tbuf += `</ul>`;\n\t}\n\tif (started.length) {\n\t\tif (signups.length) buf += `<br />`;\n\t\tbuf += `<strong>Started:</strong><ul class=\"roomlist\">`;\n\t\tfor (const tour of started) {\n\t\t\tbuf += renderLink(tour);\n\t\t}\n\t\tbuf += `</ul>`;\n\t}\n\treturn buf;\n}\n\nexport const pages: Chat.PageTable = {\n\ttournaments: {\n\t\tall(query, user) {\n\t\t\tlet buf = `${refresh(this.pageid)}<br /><center>`;\n\t\t\tbuf += `<h2><psicon pokemon=\"Meloetta-Pirouette\" />Welcome!<psicon pokemon=\"Meloetta-Pirouette\" /></h2>`;\n\t\t\tconst icon = tours.official.icon;\n\t\t\tif (icon) buf += `<img src=\"${icon[0]}\" width=\"${icon[1] / 2}\" height=\"${icon[2] / 2}\"></center>`;\n\t\t\tbuf += `<hr />`;\n\t\t\tthis.title = '[Tournaments] All';\n\t\t\tbuf += `<p>Smogon runs official tournaments across their metagames where the strongest and most `;\n\t\t\tbuf += `experienced competitors duke it out for prizes and recognition!</p><p>`;\n\t\t\tbuf += `You can see a listing of current official tournaments here; `;\n\t\t\tbuf += `by clicking any hyperlink, you will be directed to the forum for any given tournament!</p><p>`;\n\t\t\tbuf += `Be sure to sign up if you are eager to participate or `;\n\t\t\tbuf += `check it out if you want to spectate the most hyped games out there.</p><p>`;\n\t\t\tbuf += `For information on tournament rules and etiquette, check out <a href=\"https://www.smogon.com/forums/threads/3642760/\">this information thread</a>.`;\n\t\t\tbuf += `</p><ul class=\"roomlist\">`;\n\t\t\tbuf += Object.keys(tours).map(catID => (\n\t\t\t\t`<li><a class=\"blocklink\" target=\"replace\" href=\"/view-tournaments-section-${catID}\">` +\n\t\t\t\t`<i class=\"fa fa-play\"></i> <strong>${tours[catID].title}</strong></a></li>`\n\t\t\t)).join(' ');\n\t\t\tbuf += `</ul>`;\n\t\t\tbuf += `<hr />`;\n\t\t\tbuf += `<h2>Instant Tournaments</h2>`;\n\t\t\tbuf += `<div>` + instantTournaments() + `</div>`;\n\t\t\treturn renderPageChooser('', buf, user);\n\t\t},\n\t\tview(query, user) {\n\t\t\tconst [categoryID, tourID] = query.map(toID);\n\t\t\tif (!categoryID || !tourID) {\n\t\t\t\treturn error('', 'You must specify a tour category and a tour ID.', user);\n\t\t\t}\n\t\t\tthis.title = `[Tournaments] [${categoryID}] `;\n\t\t\tif (!tours[categoryID]) {\n\t\t\t\treturn error('', `Invalid tour section: '${categoryID}'.`, user);\n\t\t\t}\n\t\t\tconst tour = getTour(categoryID, tourID);\n\t\t\tif (!tour) {\n\t\t\t\treturn error(categoryID, `Tour '${tourID}' not found.`, user);\n\t\t\t}\n\t\t\t// unescaping since it's escaped on client\n\t\t\tthis.title += `${tour.title}`\n\t\t\t\t.replace(/&quot;/g, '\"')\n\t\t\t\t.replace(/&gt;/g, '>')\n\t\t\t\t.replace(/&lt;/g, '<')\n\t\t\t\t.replace(/&amp;/g, '&');\n\t\t\t// stuff!\n\t\t\tlet buf = `${back(categoryID)}${refresh(this.pageid)}<br />`;\n\t\t\tbuf += `<center><h2><a href=\"${tour.url}\">${tour.title}</a></h2>`;\n\t\t\tif (tour.image) {\n\t\t\t\tbuf += `<img src=\"${tour.image[0]}\" width=\"${tour.image[1]}\" height=\"${tour.image[2]}\" />`;\n\t\t\t\tif (tour.artistCredit) {\n\t\t\t\t\tbuf += `<br /><small>The creator of this image, ${tour.artistCredit.name}, `;\n\t\t\t\t\tbuf += `<a href=\"${tour.artistCredit.url}\">can be found here.</a></small>`;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuf += `</center>`;\n\t\t\tif (tour.ends) {\n\t\t\t\tbuf += `<br />Signups end: ${Chat.toTimestamp(new Date(tour.ends)).split(' ')[0]}`;\n\t\t\t}\n\t\t\tbuf += `<hr />`;\n\t\t\tbuf += Utils.escapeHTML(tour.desc).replace(/\\n/ig, '<br />');\n\t\t\tbuf += `<br /><br /><a class=\"button notifying\" href=\"${tour.url}\">View information and signups</a>`;\n\t\t\ttry {\n\t\t\t\tcheckCanEdit(user, this, categoryID);\n\t\t\t\tbuf += `<br /><br /><details class=\"readmore\"><summary>Manage</summary>`;\n\t\t\t\tbuf += `<button class=\"button\" name=\"send\" value=\"/smogtours end ${categoryID},${tourID}\">End tour</button>`;\n\t\t\t\tbuf += `</details>`;\n\t\t\t} catch {}\n\t\t\treturn renderPageChooser(query.join('-'), buf, user);\n\t\t},\n\t\tsection(query, user) {\n\t\t\tconst categoryID = toID(query.shift());\n\t\t\tif (!categoryID) {\n\t\t\t\treturn error('', `No section specified.`, user);\n\t\t\t}\n\t\t\tthis.title = '[Tournaments] ' + categoryID;\n\t\t\tconst category = tours[categoryID];\n\t\t\tif (!category) {\n\t\t\t\treturn error('', Utils.html`Invalid section specified: '${categoryID}'`, user);\n\t\t\t}\n\t\t\tlet buf = `${back()}${refresh(this.pageid)}<br /><center><h2>${category.title}</h2>`;\n\t\t\tif (category.icon) {\n\t\t\t\tbuf += `<img src=\"${category.icon[0]}\" width=\"${category.icon[1]}\" height=\"${category.icon[2]}\" /><br />`;\n\t\t\t}\n\t\t\tbuf += `</center>${category.desc}<hr />`;\n\t\t\tlet needsSave = false;\n\t\t\tfor (const [i, tour] of category.tours.entries()) {\n\t\t\t\tif (tour.ends && (tour.ends < Date.now())) {\n\t\t\t\t\tcategory.tours.splice(i, 1);\n\t\t\t\t\tneedsSave = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (needsSave) saveTours();\n\t\t\tif (!category.tours.length) {\n\t\t\t\tbuf += `<p>There are currently no tournaments in this section with open signups.</p>`;\n\t\t\t\tbuf += `<p>Check back later for new tours.</p>`;\n\t\t\t} else {\n\t\t\t\tbuf += category.tours.map(tour => {\n\t\t\t\t\tlet innerBuf = `<div class=\"infobox\">`;\n\t\t\t\t\tinnerBuf += `<a href=\"/view-tournaments-view-${categoryID}-${tour.id}\">${tour.title}</a><br />`;\n\t\t\t\t\tinnerBuf += Utils.escapeHTML(tour.shortDesc);\n\t\t\t\t\tinnerBuf += `</div>`;\n\t\t\t\t\treturn innerBuf;\n\t\t\t\t}).join('<br />');\n\t\t\t}\n\t\t\treturn renderPageChooser(categoryID, buf, user);\n\t\t},\n\t\tstart(query, user) {\n\t\t\tcheckCanEdit(user, this); // broad check first\n\t\t\tlet buf = `${refresh(this.pageid)}<br />`;\n\t\t\tthis.title = '[Tournaments] Add';\n\t\t\tbuf += `<center><h2>Add new tournament</h2></center><hr />`;\n\t\t\tbuf += `<form data-submitsend=\"/smogtours add {title}|{category}|{url}|{enddate}|{img}|{credit}|{artist}|{shortDesc}|{desc}\">`;\n\t\t\tlet possibleCategory = Object.keys(tours)[0];\n\t\t\tfor (const k in tours) {\n\t\t\t\tif (tours[k].whitelist?.includes(user.id)) {\n\t\t\t\t\t// favor first one where user is whitelisted where applicable\n\t\t\t\t\tpossibleCategory = k;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbuf += `Title: <input name=\"title\" /><br />`;\n\t\t\tbuf += `Category: <select name=\"category\">`;\n\t\t\tconst keys = Utils.sortBy(Object.keys(tours), k => [k === possibleCategory, k]).filter(cat => (\n\t\t\t\tcheckWhitelisted(toID(cat), user) || user.can('rangeban')\n\t\t\t));\n\t\t\tbuf += keys.map(k => `<option>${k}</option>`).join('');\n\t\t\tbuf += `</select><br />`;\n\t\t\tbuf += `Info link: <input name=\"url\" /><br />`;\n\t\t\tbuf += `End date: <input type=\"date\" name=\"enddate\" value=\"${Chat.toTimestamp(new Date()).split(' ')[0]}\" /><br />`;\n\t\t\tbuf += `<abbr title=\"Max length and width: 300px\">Image link</abbr> (optional): <input name=\"img\" /><br />`;\n\t\t\tbuf += `Artist name (required if image provided): <input name=\"artist\" /><br />`;\n\t\t\tbuf += `Image credit URL (required if image provided, must be a link to the creator's Smogon profile): `;\n\t\t\tbuf += `<input name=\"credit\" /><br />`;\n\t\t\tbuf += `Short description: <br /><textarea name=\"shortDesc\" rows=\"6\" cols=\"50\"></textarea><br />`;\n\t\t\tbuf += `Full description: <br /><textarea name=\"desc\" rows=\"20\" cols=\"50\"></textarea><br />`;\n\t\t\tbuf += `<button type=\"submit\" class=\"button notifying\">Create!</button></form>`;\n\t\t\treturn renderPageChooser('start', buf, user);\n\t\t},\n\t\t// edit single\n\t\tedit(query, user) {\n\t\t\tthis.title = '[Tournaments] Edit ';\n\t\t\tconst [sectionID, tourID] = query.map(toID);\n\t\t\tif (!sectionID || !tourID) {\n\t\t\t\treturn Chat.resolvePage(`view-tournaments-manage`, user, this.connection);\n\t\t\t}\n\t\t\tconst section = tours[sectionID];\n\t\t\tif (!section) return error('edit', `Invalid section: \"${sectionID}\"`, user);\n\t\t\tconst tour = section.tours.find(t => t.id === tourID);\n\t\t\tif (!tour) return error('edit', `Tour with ID \"${tourID}\" not found.`, user);\n\t\t\tlet buf = `${refresh(this.pageid)}<br /><center><h2>Edit tournament \"${tour.title}\"</h2></center><hr />`;\n\t\t\tbuf += `<form data-submitsend=\"/smogtours edit ${tour.id}|{title}|${sectionID}|{url}|{enddate}|{img}|{credit}|{artist}|{shortDesc}|{desc}\">`;\n\t\t\tbuf += `Title: <input name=\"title\" value=\"${tour.title}\"/><br />`;\n\t\t\tbuf += `Info link: <input name=\"url\" value=\"${tour.url}\" /><br />`;\n\t\t\tconst curEndDay = Chat.toTimestamp(new Date(tour.ends || Date.now())).split(' ')[0];\n\t\t\tbuf += `End date: <input type=\"date\" name=\"enddate\" value=\"${curEndDay}\" /><br />`;\n\t\t\tbuf += `Image link (optional): <input name=\"img\" value=\"${tour.image?.[0] || \"\"}\" /><br />`;\n\t\t\tbuf += `Artist name (required if image provided): <input name=\"artist\" value=\"${tour.artistCredit?.name}\" /><br />`;\n\t\t\tbuf += `Image credit (required if image provided, must be a link to the creator's Smogon profile): `;\n\t\t\tbuf += `<input name=\"credit\" value=\"${tour.artistCredit?.url || \"\"}\"/><br />`;\n\t\t\tbuf += `Short description: <br />`;\n\t\t\tbuf += `<textarea name=\"shortDesc\" rows=\"6\" cols=\"50\">${tour.shortDesc}</textarea><br />`;\n\t\t\tconst desc = Utils.escapeHTML(tour.desc).replace(/<br \\/>/g, '&#10;');\n\t\t\tbuf += `Full description: <br /><textarea name=\"desc\" rows=\"20\" cols=\"50\">${desc}</textarea><br />`;\n\t\t\tbuf += `<button type=\"submit\" class=\"button notifying\">Update!</button>`;\n\t\t\treturn renderPageChooser('edit', buf, user);\n\t\t},\n\t\t// panel for all you have perms to edit\n\t\tmanage(query, user) {\n\t\t\tcheckCanEdit(user, this);\n\t\t\tthis.title = '[Tournaments] Manage';\n\t\t\tlet buf = `${refresh(this.pageid)}<br /><center><h2>Manage ongoing tournaments</h2></center><hr />`;\n\t\t\tbuf += Object.keys(tours).map(cat => {\n\t\t\t\tlet innerBuf = '';\n\t\t\t\ttry {\n\t\t\t\t\tcheckCanEdit(user, this, toID(cat));\n\t\t\t\t} catch {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t\tconst section = tours[cat];\n\t\t\t\tinnerBuf += `<strong>${section.title}</strong>:<br />`;\n\t\t\t\tfor (const [i, tour] of section.tours.entries()) {\n\t\t\t\t\tif (tour.ends && Date.now() > tour.ends) {\n\t\t\t\t\t\tsection.tours.splice(i, 1);\n\t\t\t\t\t\tsaveTours();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tinnerBuf += section.tours.map(\n\t\t\t\t\tt => `&bull; <a href=\"/view-tournaments-edit-${cat}-${t.id}\">${t.title}</a>`\n\t\t\t\t).join('<br />') || \"None active.\";\n\t\t\t\treturn innerBuf;\n\t\t\t}).filter(Boolean).join('<hr />');\n\t\t\treturn renderPageChooser('manage', buf, user);\n\t\t},\n\t\twhitelists(query, user) {\n\t\t\tthis.checkCan('rangeban');\n\t\t\tlet buf = `${refresh(this.pageid)}<br /><center><h2>Section whitelists</center</h2><hr />`;\n\t\t\tfor (const k in tours) {\n\t\t\t\tbuf += `<strong>${tours[k].title}</strong><br />`;\n\t\t\t\tconst whitelist = tours[k].whitelist || [];\n\t\t\t\tif (!whitelist.length) {\n\t\t\t\t\tbuf += `None.<br />`;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tbuf += Utils.sortBy(whitelist).map(f => `<li>${f}</li>`).join('');\n\t\t\t\tbuf += `<br />`;\n\t\t\t}\n\t\t\treturn renderPageChooser('whitelist', buf, user);\n\t\t},\n\t},\n};\n\nprocess.nextTick(() => {\n\tChat.multiLinePattern.register('/smogtours (add|edit)');\n});\n"],
  "mappings": "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",
  "names": []
}

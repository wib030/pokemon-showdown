{
  "version": 3,
  "sources": ["../../../server/chat-plugins/room-events.ts"],
  "sourcesContent": ["/**\n * Room Events Plugin\n * Pokemon Showdown - http://pokemonshowdown.com/\n *\n * This is a room-management system to keep track of upcoming room events.\n *\n * @license MIT license\n */\nimport { Utils } from '../../lib';\n\nexport interface RoomEvent {\n\teventName: string;\n\tdate: string;\n\tdesc: string;\n\tstarted: boolean;\n}\n\nexport interface RoomEventAlias {\n\teventID: ID;\n}\n\nexport interface RoomEventCategory {\n\tevents: ID[];\n}\n\nfunction convertAliasFormat(room: Room) {\n\tif (!room.settings.events) return;\n\tfor (const event of Object.values(room.settings.events) as AnyObject[]) {\n\t\tif (!event.aliases) continue;\n\t\tfor (const alias of event.aliases) {\n\t\t\troom.settings.events[alias] = { eventID: toID(event.eventName) };\n\t\t}\n\t\tdelete event.aliases;\n\t}\n}\n\nfunction formatEvent(room: Room, event: RoomEvent, showAliases?: boolean, showCategories?: boolean) {\n\tconst timeRemaining = new Date(event.date).getTime() - new Date().getTime();\n\tlet explanation = timeRemaining.toString();\n\tif (!timeRemaining) explanation = \"The time remaining for this event is not available\";\n\tif (timeRemaining < 0) explanation = \"This event will start soon\";\n\tif (event.started) explanation = \"This event has started\";\n\tif (!isNaN(timeRemaining)) {\n\t\texplanation = `This event will start in: ${Chat.toDurationString(timeRemaining, { precision: 2 })}`;\n\t}\n\n\tconst eventID = toID(event.eventName);\n\tconst aliases = getAliases(room, eventID);\n\tconst categories = getAllCategories(room).filter(\n\t\tcategory => (room.settings.events![category] as RoomEventCategory).events.includes(eventID)\n\t);\n\n\tlet ret = `<tr title=\"${explanation}\">`;\n\tret += Utils.html`<td>${event.eventName}</td>`;\n\tif (showAliases) ret += Utils.html`<td>${aliases.join(\", \")}</td>`;\n\tif (showCategories) ret += Utils.html`<td>${categories.join(\", \")}</td>`;\n\tret += `<td>${Chat.formatText(event.desc, true)}</td>`;\n\tret += Utils.html`<td><time>${event.date}</time></td></tr>`;\n\treturn ret;\n}\n\nfunction getAliases(room: Room, eventID?: ID) {\n\tif (!room.settings.events) return [];\n\tconst aliases: string[] = [];\n\tfor (const aliasID in room.settings.events) {\n\t\tif (\n\t\t\t'eventID' in room.settings.events[aliasID] &&\n\t\t\t(!eventID || room.settings.events[aliasID].eventID === eventID)\n\t\t) aliases.push(aliasID);\n\t}\n\treturn aliases;\n}\n\nfunction getAllCategories(room: Room) {\n\tif (!room.settings.events) return [];\n\tconst categories: string[] = [];\n\tfor (const categoryID in room.settings.events) {\n\t\tif ('events' in room.settings.events[categoryID]) categories.push(categoryID);\n\t}\n\treturn categories;\n}\n\nfunction getAllEvents(room: Room) {\n\tif (!room.settings.events) return [];\n\tconst events: RoomEvent[] = [];\n\tfor (const event of Object.values(room.settings.events)) {\n\t\tif ('eventName' in event) events.push(event);\n\t}\n\treturn events;\n}\n\nfunction getEventID(nameOrAlias: string, room: Room): ID {\n\tlet id = toID(nameOrAlias);\n\tconst event = room.settings.events?.[id];\n\tif (event && 'eventID' in event) {\n\t\tid = event.eventID;\n\t}\n\treturn id;\n}\n\nexport const commands: Chat.ChatCommands = {\n\tevents: 'roomevents',\n\troomevent: 'roomevents',\n\troomevents: {\n\t\t''(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tif (!room.settings.events || !Object.keys(room.settings.events).length) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"There are currently no planned upcoming events for this room.\");\n\t\t\t}\n\t\t\tif (!this.runBroadcast()) return;\n\t\t\tconvertAliasFormat(room);\n\t\t\tconst hasAliases = getAliases(room).length > 0;\n\t\t\tconst hasCategories = getAllCategories(room).length > 0;\n\n\t\t\tlet buff = '<table border=\"1\" cellspacing=\"0\" cellpadding=\"3\">';\n\t\t\tbuff += '<th>Event Name:</th>';\n\t\t\tif (hasAliases) buff += '<th>Event Aliases:</th>';\n\t\t\tif (hasCategories) buff += '<th>Event Categories:</th>';\n\t\t\tbuff += '<th>Event Description:</th><th>Event Date:</th>';\n\n\t\t\tfor (const event of getAllEvents(room)) {\n\t\t\t\tbuff += formatEvent(room, event, hasAliases, hasCategories);\n\t\t\t}\n\t\t\tbuff += '</table>';\n\t\t\treturn this.sendReply(`|raw|<div class=\"infobox-limited\">${buff}</div>`);\n\t\t},\n\n\t\tnew: 'add',\n\t\tcreate: 'add',\n\t\tedit: 'add',\n\t\tadd(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tif (!room.settings.events) room.settings.events = Object.create(null);\n\t\t\tconvertAliasFormat(room);\n\t\t\tconst events = room.settings.events!;\n\t\t\tconst [eventName, date, ...desc] = target.split(target.includes('|') ? '|' : ',');\n\n\t\t\tif (!(eventName && date && desc)) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"You're missing a command parameter - to see this command's syntax, use /help roomevents.\");\n\t\t\t}\n\n\t\t\tconst dateActual = date.trim();\n\t\t\tconst descString = desc.join(target.includes('|') ? '|' : ',').trim();\n\n\t\t\tif (eventName.trim().length > 50) throw new Chat.ErrorMessage(\"Event names should not exceed 50 characters.\");\n\t\t\tif (dateActual.length > 150) throw new Chat.ErrorMessage(\"Event dates should not exceed 150 characters.\");\n\t\t\tif (descString.length > 1000) throw new Chat.ErrorMessage(\"Event descriptions should not exceed 1000 characters.\");\n\n\t\t\tconst eventId = getEventID(eventName, room);\n\t\t\tif (!eventId) throw new Chat.ErrorMessage(\"Event names must contain at least one alphanumerical character.\");\n\n\t\t\tconst oldEvent = room.settings.events?.[eventId] as RoomEvent;\n\t\t\tif (oldEvent && 'events' in oldEvent) throw new Chat.ErrorMessage(`\"${eventId}\" is already the name of a category.`);\n\n\t\t\tconst eventNameActual = (oldEvent ? oldEvent.eventName : eventName.trim());\n\t\t\tthis.privateModAction(`${user.name} ${oldEvent ? \"edited the\" : \"added a\"} roomevent titled \"${eventNameActual}\".`);\n\t\t\tthis.modlog('ROOMEVENT', null, `${oldEvent ? \"edited\" : \"added\"} \"${eventNameActual}\"`);\n\t\t\tevents[eventId] = {\n\t\t\t\teventName: eventNameActual,\n\t\t\t\tdate: dateActual,\n\t\t\t\tdesc: descString,\n\t\t\t\tstarted: false,\n\t\t\t};\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\trename(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tlet [oldName, newName] = target.split(target.includes('|') ? '|' : ',');\n\t\t\tif (!(oldName && newName)) throw new Chat.ErrorMessage(\"Usage: /roomevents rename [old name], [new name]\");\n\n\t\t\tconvertAliasFormat(room);\n\t\t\tnewName = newName.trim();\n\t\t\tconst newID = toID(newName);\n\t\t\tconst oldID = (getAliases(room).includes(toID(oldName)) ? getEventID(oldName, room) : toID(oldName));\n\t\t\tif (newID === oldID) throw new Chat.ErrorMessage(\"The new name must be different from the old one.\");\n\t\t\tif (!newID) throw new Chat.ErrorMessage(\"Event names must contain at least one alphanumeric character.\");\n\t\t\tif (newName.length > 50) throw new Chat.ErrorMessage(\"Event names should not exceed 50 characters.\");\n\n\t\t\tconst events = room.settings.events!;\n\t\t\tconst eventData = events?.[oldID];\n\t\t\tif (!(eventData && 'eventName' in eventData)) throw new Chat.ErrorMessage(`There is no event titled \"${oldName}\".`);\n\t\t\tif (events?.[newID]) {\n\t\t\t\tthrow new Chat.ErrorMessage(`\"${newName}\" is already an event, alias, or category.`);\n\t\t\t}\n\n\t\t\tconst originalName = eventData.eventName;\n\t\t\teventData.eventName = newName;\n\t\t\tevents[newID] = eventData;\n\t\t\tdelete events[oldID];\n\n\t\t\tthis.privateModAction(`${user.name} renamed the roomevent titled \"${originalName}\" to \"${newName}\".`);\n\t\t\tthis.modlog('ROOMEVENT', null, `renamed \"${originalName}\" to \"${newName}\"`);\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\tbegin: 'start',\n\t\tstart(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tif (!room.settings.events || !Object.keys(room.settings.events).length) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"There are currently no planned upcoming events for this room to start.\");\n\t\t\t}\n\t\t\tif (!target) throw new Chat.ErrorMessage(\"Usage: /roomevents start [event name]\");\n\t\t\tconvertAliasFormat(room);\n\n\t\t\ttarget = toID(target);\n\t\t\tconst event = room.settings.events[getEventID(target, room)];\n\t\t\tif (!(event && 'eventName' in event)) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There is no event titled '${target}'. Check spelling?`);\n\t\t\t}\n\t\t\tif (event.started) {\n\t\t\t\tthrow new Chat.ErrorMessage(`The event ${event.eventName} has already started.`);\n\t\t\t}\n\t\t\tfor (const u in room.users) {\n\t\t\t\tconst activeUser = Users.get(u);\n\t\t\t\tif (activeUser?.connected) {\n\t\t\t\t\tactiveUser.sendTo(\n\t\t\t\t\t\troom,\n\t\t\t\t\t\tUtils.html`|notify|A new roomevent in ${room.title} has started!|` +\n\t\t\t\t\t\t`The \"${event.eventName}\" roomevent has started!`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.add(\n\t\t\t\tUtils.html`|raw|<div class=\"broadcast-blue\"><b>The \"${event.eventName}\" roomevent has started!</b></div>`\n\t\t\t);\n\t\t\tthis.modlog('ROOMEVENT', null, `started \"${toID(event.eventName)}\"`);\n\t\t\tevent.started = true;\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\tdelete: 'remove',\n\t\tremove(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tif (!room.settings.events || Object.keys(room.settings.events).length === 0) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"There are currently no planned upcoming events for this room to remove.\");\n\t\t\t}\n\t\t\tif (!target) throw new Chat.ErrorMessage(\"Usage: /roomevents remove [event name]\");\n\t\t\tconst eventID = toID(target);\n\t\t\tconvertAliasFormat(room);\n\t\t\tif (getAliases(room).includes(eventID)) throw new Chat.ErrorMessage(\"To delete aliases, use /roomevents removealias.\");\n\t\t\tif (!(room.settings.events[eventID] && 'eventName' in room.settings.events[eventID])) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There is no event titled '${target}'. Check spelling?`);\n\t\t\t}\n\n\t\t\tdelete room.settings.events[eventID];\n\t\t\tfor (const alias of getAliases(room, eventID)) {\n\t\t\t\tdelete room.settings.events[alias];\n\t\t\t}\n\t\t\tfor (const category of getAllCategories(room).map(cat => room.settings.events?.[cat] as RoomEventCategory)) {\n\t\t\t\tcategory.events = category.events.filter(event => event !== eventID);\n\t\t\t}\n\n\t\t\tthis.privateModAction(`${user.name} removed a roomevent titled \"${target}\".`);\n\t\t\tthis.modlog('ROOMEVENT', null, `removed \"${target}\"`);\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\tview(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tif (!room.settings.events || !Object.keys(room.settings.events).length) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"There are currently no planned upcoming events for this room.\");\n\t\t\t}\n\n\t\t\tif (!target) throw new Chat.ErrorMessage(\"Usage: /roomevents view [event name, alias, or category]\");\n\t\t\tconvertAliasFormat(room);\n\t\t\ttarget = getEventID(target, room);\n\n\t\t\tlet events: RoomEvent[] = [];\n\t\t\tif (getAllCategories(room).includes(target)) {\n\t\t\t\tfor (const categoryID of Object.keys(room.settings.events)) {\n\t\t\t\t\tconst category = room.settings.events[categoryID];\n\t\t\t\t\tif ('events' in category && categoryID === target) {\n\t\t\t\t\t\tevents = category.events\n\t\t\t\t\t\t\t.map(e => room.settings.events?.[e] as RoomEvent)\n\t\t\t\t\t\t\t.filter(e => e);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (room.settings.events[target] && 'eventName' in room.settings.events[target]) {\n\t\t\t\tevents.push(room.settings.events[target] as RoomEvent);\n\t\t\t} else {\n\t\t\t\tthrow new Chat.ErrorMessage(`There is no event or category titled '${target}'. Check spelling?`);\n\t\t\t}\n\t\t\tif (!this.runBroadcast()) return;\n\t\t\tlet hasAliases = false;\n\t\t\tlet hasCategories = false;\n\n\t\t\tfor (const event of events) {\n\t\t\t\tif (getAliases(room, toID(event.eventName)).length) hasAliases = true;\n\t\t\t}\n\n\t\t\tfor (const potentialCategory of getAllCategories(room)) {\n\t\t\t\tif (\n\t\t\t\t\tevents.map(event => toID(event.eventName))\n\t\t\t\t\t\t.filter(id => (room.settings.events?.[potentialCategory] as RoomEventCategory).events.includes(id)).length\n\t\t\t\t) hasCategories = true; break;\n\t\t\t}\n\n\t\t\tlet buff = '<table border=\"1\" cellspacing=\"0\" cellpadding=\"3\">';\n\t\t\tbuff += '<th>Event Name:</th>';\n\t\t\tif (hasAliases) buff += '<th>Event Aliases:</th>';\n\t\t\tif (hasCategories) buff += '<th>Event Categories:</th>';\n\t\t\tbuff += '<th>Event Description:</th><th>Event Date:</th>';\n\t\t\tfor (const event of events) {\n\t\t\t\tbuff += formatEvent(room, event, hasAliases, hasCategories);\n\t\t\t}\n\t\t\tbuff += '</table>';\n\n\t\t\tthis.sendReply(`|raw|<div class=\"infobox-limited\">${buff}</div>`);\n\t\t\tif (!this.broadcasting && user.can('ban', null, room, 'roomevents add') && events.length === 1) {\n\t\t\t\tconst event = events[0];\n\t\t\t\tthis.sendReplyBox(Utils.html`<details><summary>Source</summary><code style=\"white-space: pre-wrap; display: table; tab-size: 3\">/roomevents add ${event.eventName} | ${event.date} | ${event.desc}</code></details>`.replace(/\\n/g, '<br />'));\n\t\t\t}\n\t\t},\n\n\t\talias: 'addalias',\n\t\taddalias(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tconst [alias, eventId] = target.split(target.includes('|') ? '|' : ',').map(argument => toID(argument));\n\t\t\tif (!(alias && eventId)) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"Usage: /roomevents addalias [alias], [event name]. Aliases must contain at least one alphanumeric character.\");\n\t\t\t}\n\t\t\tif (!room.settings.events || Object.keys(room.settings.events).length === 0) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There are currently no scheduled events.`);\n\t\t\t}\n\t\t\tconvertAliasFormat(room);\n\t\t\tconst event = room.settings.events[eventId];\n\t\t\tif (!(event && 'eventName' in event)) throw new Chat.ErrorMessage(`There is no event titled \"${eventId}\".`);\n\t\t\tif (room.settings.events[alias]) throw new Chat.ErrorMessage(`\"${alias}\" is already an event, alias, or category.`);\n\n\t\t\troom.settings.events[alias] = { eventID: eventId };\n\t\t\tthis.privateModAction(`${user.name} added an alias \"${alias}\" for the roomevent \"${eventId}\".`);\n\t\t\tthis.modlog('ROOMEVENT', null, `alias for \"${eventId}\": \"${alias}\"`);\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\tdeletealias: 'removealias',\n\t\tremovealias(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\ttarget = toID(target);\n\t\t\tif (!target) throw new Chat.ErrorMessage(\"Usage: /roomevents removealias <alias>\");\n\t\t\tif (!room.settings.events || Object.keys(room.settings.events).length === 0) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There are currently no scheduled events.`);\n\t\t\t}\n\t\t\tconvertAliasFormat(room);\n\t\t\tif (!(room.settings.events[target] && 'eventID' in room.settings.events[target])) {\n\t\t\t\tthrow new Chat.ErrorMessage(`${target} isn't an alias.`);\n\t\t\t}\n\t\t\tdelete room.settings.events[target];\n\n\t\t\tthis.privateModAction(`${user.name} removed the alias \"${target}\"`);\n\t\t\tthis.modlog('ROOMEVENT', null, `removed the alias \"${target}\"`);\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\taddtocategory(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tconst [eventId, categoryId] = target.split(target.includes('|') ? '|' : ',').map(argument => toID(argument));\n\t\t\tif (!(eventId && categoryId)) throw new Chat.ErrorMessage(\"Usage: /roomevents addtocategory [event name], [category].\");\n\t\t\tif (!room.settings.events || Object.keys(room.settings.events).length === 0) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There are currently no scheduled events.`);\n\t\t\t}\n\t\t\tconvertAliasFormat(room);\n\t\t\tconst event = room.settings.events[getEventID(eventId, room)];\n\t\t\tif (!(event && 'eventName' in event)) throw new Chat.ErrorMessage(`There is no event or alias titled \"${eventId}\".`);\n\t\t\tconst category = room.settings.events[categoryId];\n\t\t\tif (category && !('events' in category)) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There is already an event or alias titled \"${categoryId}\".`);\n\t\t\t}\n\t\t\tif (!category) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There is no category titled \"${categoryId}\". To create it, use /roomevents addcategory ${categoryId}.`);\n\t\t\t}\n\t\t\tif (category.events.includes(toID(event.eventName))) {\n\t\t\t\tthrow new Chat.ErrorMessage(`The event \"${eventId}\" is already in the \"${categoryId}\" category.`);\n\t\t\t}\n\t\t\tcategory.events.push(toID(event.eventName));\n\t\t\troom.settings.events[categoryId] = category;\n\n\t\t\tthis.privateModAction(`${user.name} added the roomevent \"${eventId}\" to the category \"${categoryId}\".`);\n\t\t\tthis.modlog('ROOMEVENT', null, `category for \"${eventId}\": \"${categoryId}\"`);\n\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\tremovefromcategory(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tconst [eventId, categoryId] = target.split(target.includes('|') ? '|' : ',').map(argument => toID(argument));\n\t\t\tif (!(eventId && categoryId)) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"Usage: /roomevents removefromcategory [event name], [category].\");\n\t\t\t}\n\t\t\tif (!room.settings.events || Object.keys(room.settings.events).length === 0) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There are currently no scheduled events.`);\n\t\t\t}\n\t\t\tconvertAliasFormat(room);\n\t\t\tconst event = room.settings.events[getEventID(eventId, room)];\n\t\t\tif (!(event && 'eventName' in event)) throw new Chat.ErrorMessage(`There is no event or alias titled \"${eventId}\".`);\n\n\t\t\tconst category = room.settings.events[categoryId];\n\t\t\tif (category && !('events' in category)) {\n\t\t\t\tthrow new Chat.ErrorMessage(`There is already an event or alias titled \"${categoryId}\".`);\n\t\t\t}\n\t\t\tif (!category) throw new Chat.ErrorMessage(`There is no category titled \"${categoryId}\".`);\n\n\t\t\tif (!category.events.includes(toID(event.eventName))) {\n\t\t\t\tthrow new Chat.ErrorMessage(`The event \"${eventId}\" isn't in the \"${categoryId}\" category.`);\n\t\t\t}\n\t\t\tcategory.events = category.events.filter(e => e !== eventId);\n\t\t\troom.settings.events[categoryId] = category;\n\n\t\t\tthis.privateModAction(`${user.name} removed the roomevent \"${eventId}\" from the category \"${categoryId}\".`);\n\t\t\tthis.modlog('ROOMEVENT', null, `category for \"${eventId}\": removed \"${categoryId}\"`);\n\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\taddcat: 'addcategory',\n\t\taddcategory(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tconst categoryId = toID(target);\n\t\t\tif (!target) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"Usage: /roomevents addcategory [category name]. Categories must contain at least one alphanumeric character.\");\n\t\t\t}\n\t\t\tconvertAliasFormat(room);\n\t\t\tif (!room.settings.events) room.settings.events = Object.create(null);\n\t\t\tif (room.settings.events?.[categoryId]) throw new Chat.ErrorMessage(`The category \"${target}\" already exists.`);\n\n\t\t\troom.settings.events![categoryId] = { events: [] };\n\n\t\t\tthis.privateModAction(`${user.name} added the category \"${categoryId}\".`);\n\t\t\tthis.modlog('ROOMEVENT', null, `category: added \"${categoryId}\"`);\n\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\tdeletecategory: 'removecategory',\n\t\tdeletecat: 'removecategory',\n\t\tremovecat: 'removecategory',\n\t\trmcat: 'removecategory',\n\t\tremovecategory(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.checkCan('ban', null, room);\n\t\t\tconst categoryId = toID(target);\n\t\t\tif (!target) throw new Chat.ErrorMessage(\"Usage: /roomevents removecategory [category name].\");\n\t\t\tconvertAliasFormat(room);\n\t\t\tif (!room.settings.events) room.settings.events = Object.create(null);\n\t\t\tif (!room.settings.events?.[categoryId]) throw new Chat.ErrorMessage(`The category \"${target}\" doesn't exist.`);\n\n\t\t\tdelete room.settings.events?.[categoryId];\n\n\t\t\tthis.privateModAction(`${user.name} removed the category \"${categoryId}\".`);\n\t\t\tthis.modlog('ROOMEVENT', null, `category: removed \"${categoryId}\"`);\n\n\t\t\troom.saveSettings();\n\t\t},\n\n\t\tviewcategories: 'categories',\n\t\tcategories(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tthis.runBroadcast();\n\n\t\t\tconst categoryButtons = getAllCategories(room).map(\n\t\t\t\tcategory => `<button class=\"button\" name=\"send\" value=\"/roomevents view ${category}\">${category}</button>`\n\t\t\t);\n\t\t\tif (!categoryButtons.length) throw new Chat.ErrorMessage(`There are no roomevent categories in ${room.title}.`);\n\t\t\tthis.sendReplyBox(`Roomevent categories in ${room.title}: ${categoryButtons.join(' ')}`);\n\t\t},\n\n\t\thelp(target, room, user) {\n\t\t\treturn this.parse('/help roomevents');\n\t\t},\n\n\t\tsortby(target, room, user) {\n\t\t\troom = this.requireRoom();\n\t\t\t// preconditions\n\t\t\tif (!room.persist) throw new Chat.ErrorMessage(\"This command is unavailable in temporary rooms.\");\n\t\t\tif (!room.settings.events || !Object.keys(room.settings.events).length) {\n\t\t\t\tthrow new Chat.ErrorMessage(\"There are currently no planned upcoming events for this room.\");\n\t\t\t}\n\t\t\tthis.checkCan('ban', null, room);\n\n\t\t\t// declare variables\n\t\t\tlet multiplier = 1;\n\t\t\tlet columnName = \"\";\n\t\t\tconst delimited = target.split(target.includes('|') ? '|' : ',');\n\t\t\tconst sortable = Object.values(room.settings.events)\n\t\t\t\t.filter((event): event is RoomEvent => 'eventName' in event);\n\n\t\t\t// id tokens\n\t\t\tif (delimited.length === 1) {\n\t\t\t\tcolumnName = target;\n\t\t\t} else {\n\t\t\t\tlet order = \"\";\n\t\t\t\t[columnName, order] = delimited;\n\t\t\t\torder = toID(order);\n\t\t\t\tmultiplier = (order === 'desc') ? -1 : 1;\n\t\t\t}\n\n\t\t\t// sort the array by the appropriate column name\n\t\t\tcolumnName = toID(columnName);\n\t\t\tswitch (columnName) {\n\t\t\tcase \"date\":\n\t\t\tcase \"eventdate\":\n\t\t\t\tsortable.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(toID(a.date) < toID(b.date)) ? -multiplier :\n\t\t\t\t\t\t(toID(b.date) < toID(a.date)) ? multiplier : 0\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase \"desc\":\n\t\t\tcase \"description\":\n\t\t\tcase \"eventdescription\":\n\t\t\t\tsortable.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(toID(a.desc) < toID(b.desc)) ? -multiplier :\n\t\t\t\t\t\t(toID(b.desc) < toID(a.desc)) ? multiplier : 0\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase \"eventname\":\n\t\t\tcase \"name\":\n\t\t\t\tsortable.sort(\n\t\t\t\t\t(a, b) =>\n\t\t\t\t\t\t(toID(a.eventName) < toID(b.eventName)) ? -multiplier :\n\t\t\t\t\t\t(toID(b.eventName) < toID(a.eventName)) ? multiplier : 0\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new Chat.ErrorMessage(`Invalid column name \"${columnName}\". Please use one of: date, desc, name.`);\n\t\t\t}\n\n\t\t\t// rebuild the room.settings.events object\n\t\t\tfor (const sortedObj of sortable) {\n\t\t\t\tconst eventId = toID(sortedObj.eventName);\n\t\t\t\tdelete room.settings.events[eventId];\n\t\t\t\troom.settings.events[eventId] = sortedObj;\n\t\t\t}\n\n\t\t\t// build communication string\n\t\t\tconst resultString = `sorted by column: ${columnName}` +\n\t\t\t\t` in ${multiplier === 1 ? \"ascending\" : \"descending\"} order` +\n\t\t\t\t`${delimited.length === 1 ? \" (by default)\" : \"\"}`;\n\t\t\tthis.modlog('ROOMEVENT', null, resultString);\n\t\t\treturn this.sendReply(resultString);\n\t\t},\n\t},\n\troomeventshelp() {\n\t\tthis.sendReply(\n\t\t\t`|html|<details class=\"readmore\"><summary><code>/roomevents</code>: displays a list of upcoming room-specific events.<br />` +\n\t\t\t`<code>/roomevents add [event name] | [event date/time] | [event description]</code>: adds a room event. A timestamp in event date/time field like YYYY-MM-DD HH:MM\u00B1hh:mm will be displayed in user's timezone. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents start [event name]</code>: declares to the room that the event has started. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents remove [event name]</code>: deletes an event. Requires: @ # ~</summary>` +\n\t\t\t`<code>/roomevents rename [old event name] | [new name]</code>: renames an event. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents addalias [alias] | [event name]</code>: adds an alias for the event. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents removealias [alias]</code>: removes an event alias. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents addcategory [category]</code>: adds an event category. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents removecategory [category]</code>: removes an event category. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents addtocategory [event name] | [category]</code>: adds the event to a category. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents removefromcategory [event name] | [category]</code>: removes the event from a category. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents sortby [column name] | [asc/desc (optional)]</code> sorts events table by column name and an optional argument to ascending or descending order. Ascending order is default. Requires: @ # ~<br />` +\n\t\t\t`<code>/roomevents view [event name or category]</code>: displays information about a specific event or category of events.<br />` +\n\t\t\t`<code>/roomevents viewcategories</code>: displays a list of event categories for that room.` +\n\t\t\t`</details>`\n\t\t);\n\t},\n};\n"],
  "mappings": "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",
  "names": []
}

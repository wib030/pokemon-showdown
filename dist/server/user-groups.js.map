{
  "version": 3,
  "sources": ["../../server/user-groups.ts"],
  "sourcesContent": ["import { FS } from '../lib/fs';\nimport type { RoomSection } from './chat-commands/room-settings';\nimport { toID } from '../sim/dex-data';\n\nexport type GroupSymbol = '~' | '#' | '\u2605' | '*' | '@' | '%' | '\u2606' | '\u00A7' | '+' | '^' | ' ' | '\u203D' | '!';\nexport type EffectiveGroupSymbol = GroupSymbol | 'whitelist';\nexport type AuthLevel = EffectiveGroupSymbol | 'unlocked' | 'trusted' | 'autoconfirmed';\n\nexport const PLAYER_SYMBOL: GroupSymbol = '\\u2606';\nexport const HOST_SYMBOL: GroupSymbol = '\\u2605';\n\nexport const ROOM_PERMISSIONS = [\n\t'addhtml', 'announce', 'ban', 'bypassafktimer', 'declare', 'editprivacy', 'editroom', 'exportinputlog', 'game', 'gamemanagement', 'gamemoderation', 'joinbattle', 'kick', 'minigame', 'modchat', 'modlog', 'mute', 'nooverride', 'receiveauthmessages', 'roombot', 'roomdriver', 'roommod', 'roomowner', 'roomvoice', 'roomprizewinner', 'show', 'showmedia', 'timer', 'tournaments', 'warn',\n] as const;\n\nexport const GLOBAL_PERMISSIONS = [\n\t// administrative\n\t'bypassall', 'console', 'disableladder', 'lockdown', 'potd',\n\t// other\n\t'addhtml', 'alts', 'altsself', 'autotimer', 'globalban', 'bypassblocks', 'bypassafktimer', 'forcepromote', 'forcerename', 'forcewin', 'gdeclare', 'hiderank', 'ignorelimits', 'importinputlog', 'ip', 'ipself', 'lock', 'makeroom', 'modlog', 'rangeban', 'promote',\n] as const;\n\nexport type RoomPermission = typeof ROOM_PERMISSIONS[number];\nexport type GlobalPermission = typeof GLOBAL_PERMISSIONS[number];\n\nexport type GroupInfo = {\n\tsymbol: GroupSymbol,\n\tid: ID,\n\tname: string,\n\trank: number,\n\tinherit?: GroupSymbol,\n\tjurisdiction?: string,\n\n\tglobalonly?: boolean,\n\troomonly?: boolean,\n\tbattleonly?: boolean,\n\troot?: boolean,\n\tglobalGroupInPersonalRoom?: GroupSymbol,\n} & {\n\t[P in RoomPermission | GlobalPermission]?: string | boolean;\n};\n\n/**\n * Auth table - a Map for which users are in which groups.\n *\n * Notice that auth.get will return the default group symbol if the\n * user isn't in a group.\n */\nexport abstract class Auth extends Map<ID, GroupSymbol | ''> {\n\t/**\n\t * Will return the default group symbol if the user isn't in a group.\n\t *\n\t * Passing a User will read `user.group`, which is relevant for unregistered\n\t * users with temporary global auth.\n\t */\n\toverride get(user: ID | User) {\n\t\tif (typeof user !== 'string') return user.tempGroup;\n\t\treturn super.get(user) || Auth.defaultSymbol();\n\t}\n\tisStaff(userid: ID) {\n\t\tif (this.has(userid)) {\n\t\t\tconst rank = this.get(userid);\n\t\t\t// At one point bots used to be ranked above drivers, so this checks\n\t\t\t// driver rank to make sure this function works on servers that\n\t\t\t// did not reorder the ranks.\n\t\t\treturn Auth.atLeast(rank, '*') || Auth.atLeast(rank, '%');\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t}\n\tatLeast(user: User, group: AuthLevel) {\n\t\tif (user.hasSysopAccess()) return true;\n\t\tif (group === 'trusted' || group === 'autoconfirmed') {\n\t\t\tif (user.trusted && group === 'trusted') return true;\n\t\t\tif (user.autoconfirmed && !user.locked && group === 'autoconfirmed') return true;\n\t\t\tgroup = Config.groupsranking[1];\n\t\t}\n\t\tif (user.locked || user.semilocked) return false;\n\t\tif (group === 'unlocked') return true;\n\t\tif (group === 'whitelist' && this.has(user.id)) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!Config.groups[group]) return false;\n\t\tif (this.get(user.id) === ' ' && group !== ' ') return false;\n\t\treturn Auth.atLeast(this.get(user.id), group);\n\t}\n\n\tstatic defaultSymbol() {\n\t\treturn Config.groupsranking[0] as GroupSymbol;\n\t}\n\tstatic getGroup(symbol: EffectiveGroupSymbol): GroupInfo;\n\tstatic getGroup<T>(symbol: EffectiveGroupSymbol, fallback: T): GroupInfo | T;\n\tstatic getGroup(symbol: EffectiveGroupSymbol, fallback?: AnyObject) {\n\t\tif (Config.groups[symbol]) return Config.groups[symbol];\n\n\t\tif (fallback !== undefined) return fallback;\n\n\t\t// unidentified groups are treated as voice\n\t\treturn {\n\t\t\t...Config.groups['+'],\n\t\t\tsymbol,\n\t\t\tid: 'voice',\n\t\t\tname: symbol,\n\t\t};\n\t}\n\tgetEffectiveSymbol(user: User): EffectiveGroupSymbol {\n\t\tconst group = this.get(user);\n\t\tif (this.has(user.id) && group === Auth.defaultSymbol()) {\n\t\t\treturn 'whitelist';\n\t\t}\n\t\treturn group;\n\t}\n\tstatic hasPermission(\n\t\tuser: User,\n\t\tpermission: string,\n\t\ttarget: User | EffectiveGroupSymbol | ID | null,\n\t\troom?: BasicRoom | null,\n\t\tcmd?: string,\n\t\tcmdToken?: string,\n\t): boolean {\n\t\tif (user.hasSysopAccess()) return true;\n\n\t\tconst auth: Auth = room ? room.auth : Users.globalAuth;\n\n\t\tconst symbol = auth.getEffectiveSymbol(user);\n\n\t\tlet targetSymbol: EffectiveGroupSymbol | null;\n\t\tif (!target) {\n\t\t\ttargetSymbol = null;\n\t\t} else if (typeof target === 'string' && !toID(target)) { // empty ID -> target is a group symbol\n\t\t\ttargetSymbol = target as EffectiveGroupSymbol;\n\t\t} else {\n\t\t\ttargetSymbol = auth.get(target as User | ID);\n\t\t}\n\t\tif (!targetSymbol || ['whitelist', 'trusted', 'autoconfirmed'].includes(targetSymbol)) {\n\t\t\ttargetSymbol = Auth.defaultSymbol();\n\t\t}\n\n\t\tlet group = Auth.getGroup(symbol);\n\t\tif (group['root']) return true;\n\t\t// Global drivers who are SLs should get room mod powers too\n\t\tif (\n\t\t\troom?.settings.section &&\n\t\t\troom.settings.section === Users.globalAuth.sectionLeaders.get(user.id) &&\n\t\t\t// But dont override ranks above moderator such as room owner\n\t\t\t(Auth.getGroup('@').rank > group.rank)\n\t\t) {\n\t\t\tgroup = Auth.getGroup('@');\n\t\t}\n\n\t\tlet jurisdiction = group[permission as GlobalPermission | RoomPermission];\n\t\tif (jurisdiction === true && permission !== 'jurisdiction') {\n\t\t\tjurisdiction = group['jurisdiction'] || true;\n\t\t}\n\t\tconst roomPermissions = room ? room.settings.permissions : null;\n\t\tif (roomPermissions) {\n\t\t\tlet foundSpecificPermission = false;\n\t\t\tif (cmd) {\n\t\t\t\tif (!cmdToken) cmdToken = `/`;\n\t\t\t\tconst namespace = cmd.slice(0, cmd.indexOf(' '));\n\t\t\t\tif (roomPermissions[`${cmdToken}${cmd}`]) {\n\t\t\t\t\t// this checks sub commands and command objects, but it checks to see if a sub-command\n\t\t\t\t\t// overrides (should a perm for the command object exist) first\n\t\t\t\t\tif (!auth.atLeast(user, roomPermissions[`${cmdToken}${cmd}`])) return false;\n\t\t\t\t\tjurisdiction = 'u';\n\t\t\t\t\tfoundSpecificPermission = true;\n\t\t\t\t} else if (roomPermissions[`${cmdToken}${namespace}`]) {\n\t\t\t\t\t// if it's for one command object\n\t\t\t\t\tif (!auth.atLeast(user, roomPermissions[`${cmdToken}${namespace}`])) return false;\n\t\t\t\t\tjurisdiction = 'u';\n\t\t\t\t\tfoundSpecificPermission = true;\n\t\t\t\t}\n\t\t\t\tif (foundSpecificPermission && targetSymbol === Users.Auth.defaultSymbol()) {\n\t\t\t\t\t// if /permissions has granted unranked users permission to use the command,\n\t\t\t\t\t// grant jurisdiction over unranked (since unranked users don't have jurisdiction over unranked)\n\t\t\t\t\t// see https://github.com/smogon/pokemon-showdown/pull/9534#issuecomment-1565719315\n\t\t\t\t\t(jurisdiction as string) += Users.Auth.defaultSymbol();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!foundSpecificPermission && roomPermissions[permission]) {\n\t\t\t\tif (!auth.atLeast(user, roomPermissions[permission])) return false;\n\t\t\t\tjurisdiction = 'u';\n\t\t\t}\n\t\t}\n\t\treturn Auth.hasJurisdiction(symbol, jurisdiction, targetSymbol as GroupSymbol);\n\t}\n\tstatic atLeast(symbol: EffectiveGroupSymbol, symbol2: EffectiveGroupSymbol) {\n\t\treturn Auth.getGroup(symbol).rank >= Auth.getGroup(symbol2).rank;\n\t}\n\tstatic supportedRoomPermissions(room: Room | null = null) {\n\t\tconst commands = [];\n\t\tfor (const handler of Chat.allCommands()) {\n\t\t\tif (!handler.hasRoomPermissions && !handler.broadcastable) continue;\n\n\t\t\t// if it's only broadcast permissions, not use permissions, use the broadcast symbol\n\t\t\tconst cmdPrefix = handler.hasRoomPermissions ? \"/\" : \"!\";\n\t\t\tcommands.push(`${cmdPrefix}${handler.fullCmd}`);\n\t\t\tif (handler.aliases.length) {\n\t\t\t\tfor (const alias of handler.aliases) {\n\t\t\t\t\t// kind of a hack but this is the only good way i could think of to\n\t\t\t\t\t// overwrite the alias without making assumptions about the string\n\t\t\t\t\tcommands.push(`${cmdPrefix}${handler.fullCmd.replace(handler.cmd, alias)}`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn [\n\t\t\t...ROOM_PERMISSIONS,\n\t\t\t...commands,\n\t\t];\n\t}\n\tstatic hasJurisdiction(\n\t\tsymbol: EffectiveGroupSymbol,\n\t\tjurisdiction?: string | boolean,\n\t\ttargetSymbol?: GroupSymbol | null\n\t) {\n\t\tif (!targetSymbol) {\n\t\t\treturn !!jurisdiction;\n\t\t}\n\t\tif (typeof jurisdiction !== 'string') {\n\t\t\treturn !!jurisdiction;\n\t\t}\n\t\tif (jurisdiction.includes(targetSymbol)) {\n\t\t\treturn true;\n\t\t}\n\t\tif (jurisdiction.includes('a')) {\n\t\t\treturn true;\n\t\t}\n\t\tif (jurisdiction.includes('u') && Auth.getGroup(symbol).rank > Auth.getGroup(targetSymbol).rank) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tstatic listJurisdiction(user: User, permission: GlobalPermission | RoomPermission) {\n\t\tconst symbols = Object.keys(Config.groups) as GroupSymbol[];\n\t\treturn symbols.filter(targetSymbol => Auth.hasPermission(user, permission, targetSymbol));\n\t}\n\tstatic isValidSymbol(symbol: string): symbol is GroupSymbol {\n\t\tif (symbol.length !== 1) return false;\n\t\treturn !/[A-Za-z0-9|,]/.test(symbol);\n\t}\n\tstatic isAuthLevel(level: string): level is AuthLevel {\n\t\tif (Config.groupsranking.includes(level as EffectiveGroupSymbol)) return true;\n\t\treturn ['\u203D', '!', 'unlocked', 'trusted', 'autoconfirmed', 'whitelist'].includes(level);\n\t}\n\tstatic ROOM_PERMISSIONS = ROOM_PERMISSIONS;\n\tstatic GLOBAL_PERMISSIONS = GLOBAL_PERMISSIONS;\n}\n\nexport class RoomAuth extends Auth {\n\troom: BasicRoom;\n\tconstructor(room: BasicRoom) {\n\t\tsuper();\n\t\tthis.room = room;\n\t}\n\toverride get(userOrID: ID | User): GroupSymbol {\n\t\tconst id = typeof userOrID === 'string' ? userOrID : userOrID.id;\n\n\t\tconst parentAuth: Auth | null = this.room.parent ? this.room.parent.auth :\n\t\t\tthis.room.settings.isPrivate !== true ? Users.globalAuth : null;\n\t\tconst parentGroup = parentAuth ? parentAuth.get(userOrID) : Auth.defaultSymbol();\n\n\t\tif (this.has(id)) {\n\t\t\t// authority is whichever is higher between roomauth and global auth\n\t\t\tconst roomGroup = this.getDirect(id);\n\t\t\tlet group = Config.greatergroupscache[`${roomGroup}${parentGroup}`];\n\t\t\tif (!group) {\n\t\t\t\t// unrecognized groups always trump higher global rank\n\t\t\t\tconst roomRank = Auth.getGroup(roomGroup, { rank: Infinity }).rank;\n\t\t\t\tconst globalRank = Auth.getGroup(parentGroup).rank;\n\t\t\t\tif (roomGroup === Users.PLAYER_SYMBOL || roomGroup === Users.HOST_SYMBOL || roomGroup === '#') {\n\t\t\t\t\t// Player, Host, and Room Owner always trump higher global rank\n\t\t\t\t\tgroup = roomGroup;\n\t\t\t\t} else {\n\t\t\t\t\tgroup = (roomRank > globalRank ? roomGroup : parentGroup);\n\t\t\t\t}\n\t\t\t\tConfig.greatergroupscache[`${roomGroup}${parentGroup}`] = group;\n\t\t\t}\n\t\t\treturn group;\n\t\t}\n\n\t\treturn parentGroup;\n\t}\n\toverride getEffectiveSymbol(user: User) {\n\t\tconst symbol = super.getEffectiveSymbol(user);\n\t\tif (!this.room.persist && symbol === user.tempGroup) {\n\t\t\tconst replaceGroup = Auth.getGroup(symbol).globalGroupInPersonalRoom;\n\t\t\tif (replaceGroup) return replaceGroup;\n\t\t}\n\t\t// this is a bit of a hardcode, yeah, but admins need to have admin commands in prooms w/o the symbol\n\t\t// and we want that to include sysops.\n\t\t// Plus, using user.can is cleaner than Users.globalAuth.get(user) === admin and it accounts for more things.\n\t\t// (and no this won't recurse or anything since user.can() with no room doesn't call this)\n\t\tif (this.room.settings.isPrivate === true && user.can('makeroom')) {\n\t\t\t// not hardcoding ~ here since globalAuth.get should return ~ in basically all cases\n\t\t\t// except sysops, and there's an override for them anyways so it doesn't matter\n\t\t\treturn Users.globalAuth.get(user);\n\t\t}\n\t\treturn symbol;\n\t}\n\t/** gets the room group without inheriting */\n\tgetDirect(id: ID): GroupSymbol {\n\t\treturn super.get(id);\n\t}\n\tsave() {\n\t\t// construct auth object\n\t\tconst auth = Object.create(null);\n\t\tfor (const [userid, groupSymbol] of this) {\n\t\t\tauth[userid] = groupSymbol;\n\t\t}\n\t\t(this.room.settings as any).auth = auth;\n\t\tthis.room.saveSettings();\n\t}\n\tload() {\n\t\tfor (const userid in this.room.settings.auth) {\n\t\t\tsuper.set(userid as ID, this.room.settings.auth[userid]);\n\t\t}\n\t}\n\toverride set(id: ID, symbol: GroupSymbol) {\n\t\tif (symbol === 'whitelist' as GroupSymbol) {\n\t\t\tsymbol = Auth.defaultSymbol();\n\t\t}\n\t\tsuper.set(id, symbol);\n\t\tthis.room.settings.auth[id] = symbol;\n\t\tthis.room.saveSettings();\n\n\t\tconst user = Users.get(id);\n\t\tif (user) this.room.onUpdateIdentity(user);\n\t\treturn this;\n\t}\n\toverride delete(id: ID) {\n\t\tif (!this.has(id)) return false;\n\t\tsuper.delete(id);\n\t\tdelete this.room.settings.auth[id];\n\t\tthis.room.saveSettings();\n\t\treturn true;\n\t}\n}\n\nexport class GlobalAuth extends Auth {\n\tusernames = new Map<ID, string>();\n\tsectionLeaders = new Map<ID, RoomSection>();\n\tconstructor() {\n\t\tsuper();\n\t\tthis.load();\n\t}\n\tsave() {\n\t\tFS('config/usergroups.csv').writeUpdate(() => {\n\t\t\tlet buffer = '';\n\t\t\tfor (const [userid, groupSymbol] of this) {\n\t\t\t\tbuffer += `${this.usernames.get(userid) || userid},${groupSymbol},${this.sectionLeaders.get(userid) || ''}\\n`;\n\t\t\t}\n\t\t\treturn buffer;\n\t\t});\n\t}\n\tload() {\n\t\tconst data = FS('config/usergroups.csv').readIfExistsSync();\n\t\tfor (const row of data.split(\"\\n\")) {\n\t\t\tif (!row) continue;\n\t\t\tconst [name, symbol, sectionid] = row.split(\",\");\n\t\t\tconst id = toID(name);\n\t\t\tif (!id) {\n\t\t\t\tMonitor.warn('Dropping malformed usergroups line (missing ID):');\n\t\t\t\tMonitor.warn(row);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis.usernames.set(id, name);\n\t\t\tif (sectionid) this.sectionLeaders.set(id, sectionid as RoomSection);\n\n\t\t\t// handle glitched entries where a user has two entries in usergroups.csv due to bugs\n\t\t\tconst newSymbol = symbol.charAt(0) as GroupSymbol;\n\t\t\t// Yes, we HAVE to ensure that it exists in the super. super.get here returns either the group symbol,\n\t\t\t// or the default symbol if it cannot find a symbol in the map.\n\t\t\t// the default symbol is truthy, and the symbol for trusted user is ` `\n\t\t\t// meaning that the preexisting && atLeast would return true, which would skip the row and nuke all trusted users\n\t\t\t// on a fresh load (aka, a restart).\n\t\t\tconst preexistingSymbol = super.has(id) ? super.get(id) : null;\n\t\t\t// take a user's highest rank in usergroups.csv\n\t\t\tif (preexistingSymbol && Auth.atLeast(preexistingSymbol, newSymbol)) continue;\n\t\t\tsuper.set(id, newSymbol);\n\t\t}\n\t}\n\toverride set(id: ID, group: GroupSymbol, username?: string) {\n\t\tif (!username) username = id;\n\t\tconst user = Users.get(id, true);\n\t\tif (user) {\n\t\t\tuser.tempGroup = group;\n\t\t\tuser.updateIdentity();\n\t\t\tusername = user.name;\n\t\t\tRooms.global.checkAutojoin(user);\n\t\t}\n\t\tthis.usernames.set(id, username);\n\t\tsuper.set(id, group);\n\t\tvoid this.save();\n\t\treturn this;\n\t}\n\toverride delete(id: ID) {\n\t\tif (!super.has(id)) return false;\n\t\tsuper.delete(id);\n\t\tconst user = Users.get(id);\n\t\tif (user) {\n\t\t\tuser.tempGroup = ' ';\n\t\t}\n\t\tthis.usernames.delete(id);\n\t\tthis.save();\n\t\treturn true;\n\t}\n\tsetSection(id: ID, sectionid: RoomSection, username?: string) {\n\t\tif (!username) username = id;\n\t\tconst user = Users.get(id);\n\t\tif (user) {\n\t\t\tuser.updateIdentity();\n\t\t\tusername = user.name;\n\t\t\tRooms.global.checkAutojoin(user);\n\t\t}\n\t\tif (!super.has(id)) this.set(id, ' ', username);\n\t\tthis.sectionLeaders.set(id, sectionid);\n\t\tvoid this.save();\n\t\treturn this;\n\t}\n\tdeleteSection(id: ID) {\n\t\tif (!this.sectionLeaders.has(id)) return false;\n\t\tthis.sectionLeaders.delete(id);\n\t\tif (super.get(id) === ' ') {\n\t\t\treturn this.delete(id);\n\t\t}\n\t\tconst user = Users.get(id);\n\t\tif (user) {\n\t\t\tuser.updateIdentity();\n\t\t\tRooms.global.checkAutojoin(user);\n\t\t}\n\t\tthis.save();\n\t\treturn true;\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAAmB;AAEnB,sBAAqB;AAMd,MAAM,gBAA6B;AACnC,MAAM,cAA2B;AAEjC,MAAM,mBAAmB;AAAA,EAC/B;AAAA,EAAW;AAAA,EAAY;AAAA,EAAO;AAAA,EAAkB;AAAA,EAAW;AAAA,EAAe;AAAA,EAAY;AAAA,EAAkB;AAAA,EAAQ;AAAA,EAAkB;AAAA,EAAkB;AAAA,EAAc;AAAA,EAAQ;AAAA,EAAY;AAAA,EAAW;AAAA,EAAU;AAAA,EAAQ;AAAA,EAAc;AAAA,EAAuB;AAAA,EAAW;AAAA,EAAc;AAAA,EAAW;AAAA,EAAa;AAAA,EAAa;AAAA,EAAmB;AAAA,EAAQ;AAAA,EAAa;AAAA,EAAS;AAAA,EAAe;AACvX;AAEO,MAAM,qBAAqB;AAAA;AAAA,EAEjC;AAAA,EAAa;AAAA,EAAW;AAAA,EAAiB;AAAA,EAAY;AAAA;AAAA,EAErD;AAAA,EAAW;AAAA,EAAQ;AAAA,EAAY;AAAA,EAAa;AAAA,EAAa;AAAA,EAAgB;AAAA,EAAkB;AAAA,EAAgB;AAAA,EAAe;AAAA,EAAY;AAAA,EAAY;AAAA,EAAY;AAAA,EAAgB;AAAA,EAAkB;AAAA,EAAM;AAAA,EAAU;AAAA,EAAQ;AAAA,EAAY;AAAA,EAAU;AAAA,EAAY;AAC3P;AA4BO,MAAe,aAAa,IAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOnD,IAAI,MAAiB;AAC7B,QAAI,OAAO,SAAS,SAAU,QAAO,KAAK;AAC1C,WAAO,MAAM,IAAI,IAAI,KAAK,KAAK,cAAc;AAAA,EAC9C;AAAA,EACA,QAAQ,QAAY;AACnB,QAAI,KAAK,IAAI,MAAM,GAAG;AACrB,YAAM,OAAO,KAAK,IAAI,MAAM;AAI5B,aAAO,KAAK,QAAQ,MAAM,GAAG,KAAK,KAAK,QAAQ,MAAM,GAAG;AAAA,IACzD,OAAO;AACN,aAAO;AAAA,IACR;AAAA,EACD;AAAA,EACA,QAAQ,MAAY,OAAkB;AACrC,QAAI,KAAK,eAAe,EAAG,QAAO;AAClC,QAAI,UAAU,aAAa,UAAU,iBAAiB;AACrD,UAAI,KAAK,WAAW,UAAU,UAAW,QAAO;AAChD,UAAI,KAAK,iBAAiB,CAAC,KAAK,UAAU,UAAU,gBAAiB,QAAO;AAC5E,cAAQ,OAAO,cAAc,CAAC;AAAA,IAC/B;AACA,QAAI,KAAK,UAAU,KAAK,WAAY,QAAO;AAC3C,QAAI,UAAU,WAAY,QAAO;AACjC,QAAI,UAAU,eAAe,KAAK,IAAI,KAAK,EAAE,GAAG;AAC/C,aAAO;AAAA,IACR;AACA,QAAI,CAAC,OAAO,OAAO,KAAK,EAAG,QAAO;AAClC,QAAI,KAAK,IAAI,KAAK,EAAE,MAAM,OAAO,UAAU,IAAK,QAAO;AACvD,WAAO,KAAK,QAAQ,KAAK,IAAI,KAAK,EAAE,GAAG,KAAK;AAAA,EAC7C;AAAA,EAEA,OAAO,gBAAgB;AACtB,WAAO,OAAO,cAAc,CAAC;AAAA,EAC9B;AAAA,EAGA,OAAO,SAAS,QAA8B,UAAsB;AACnE,QAAI,OAAO,OAAO,MAAM,EAAG,QAAO,OAAO,OAAO,MAAM;AAEtD,QAAI,aAAa,OAAW,QAAO;AAGnC,WAAO;AAAA,MACN,GAAG,OAAO,OAAO,GAAG;AAAA,MACpB;AAAA,MACA,IAAI;AAAA,MACJ,MAAM;AAAA,IACP;AAAA,EACD;AAAA,EACA,mBAAmB,MAAkC;AACpD,UAAM,QAAQ,KAAK,IAAI,IAAI;AAC3B,QAAI,KAAK,IAAI,KAAK,EAAE,KAAK,UAAU,KAAK,cAAc,GAAG;AACxD,aAAO;AAAA,IACR;AACA,WAAO;AAAA,EACR;AAAA,EACA,OAAO,cACN,MACA,YACA,QACA,MACA,KACA,UACU;AACV,QAAI,KAAK,eAAe,EAAG,QAAO;AAElC,UAAM,OAAa,OAAO,KAAK,OAAO,MAAM;AAE5C,UAAM,SAAS,KAAK,mBAAmB,IAAI;AAE3C,QAAI;AACJ,QAAI,CAAC,QAAQ;AACZ,qBAAe;AAAA,IAChB,WAAW,OAAO,WAAW,YAAY,KAAC,sBAAK,MAAM,GAAG;AACvD,qBAAe;AAAA,IAChB,OAAO;AACN,qBAAe,KAAK,IAAI,MAAmB;AAAA,IAC5C;AACA,QAAI,CAAC,gBAAgB,CAAC,aAAa,WAAW,eAAe,EAAE,SAAS,YAAY,GAAG;AACtF,qBAAe,KAAK,cAAc;AAAA,IACnC;AAEA,QAAI,QAAQ,KAAK,SAAS,MAAM;AAChC,QAAI,MAAM,MAAM,EAAG,QAAO;AAE1B,QACC,MAAM,SAAS,WACf,KAAK,SAAS,YAAY,MAAM,WAAW,eAAe,IAAI,KAAK,EAAE;AAAA,IAEpE,KAAK,SAAS,GAAG,EAAE,OAAO,MAAM,MAChC;AACD,cAAQ,KAAK,SAAS,GAAG;AAAA,IAC1B;AAEA,QAAI,eAAe,MAAM,UAA+C;AACxE,QAAI,iBAAiB,QAAQ,eAAe,gBAAgB;AAC3D,qBAAe,MAAM,cAAc,KAAK;AAAA,IACzC;AACA,UAAM,kBAAkB,OAAO,KAAK,SAAS,cAAc;AAC3D,QAAI,iBAAiB;AACpB,UAAI,0BAA0B;AAC9B,UAAI,KAAK;AACR,YAAI,CAAC,SAAU,YAAW;AAC1B,cAAM,YAAY,IAAI,MAAM,GAAG,IAAI,QAAQ,GAAG,CAAC;AAC/C,YAAI,gBAAgB,GAAG,QAAQ,GAAG,GAAG,EAAE,GAAG;AAGzC,cAAI,CAAC,KAAK,QAAQ,MAAM,gBAAgB,GAAG,QAAQ,GAAG,GAAG,EAAE,CAAC,EAAG,QAAO;AACtE,yBAAe;AACf,oCAA0B;AAAA,QAC3B,WAAW,gBAAgB,GAAG,QAAQ,GAAG,SAAS,EAAE,GAAG;AAEtD,cAAI,CAAC,KAAK,QAAQ,MAAM,gBAAgB,GAAG,QAAQ,GAAG,SAAS,EAAE,CAAC,EAAG,QAAO;AAC5E,yBAAe;AACf,oCAA0B;AAAA,QAC3B;AACA,YAAI,2BAA2B,iBAAiB,MAAM,KAAK,cAAc,GAAG;AAI3E,UAAC,gBAA2B,MAAM,KAAK,cAAc;AAAA,QACtD;AAAA,MACD;AACA,UAAI,CAAC,2BAA2B,gBAAgB,UAAU,GAAG;AAC5D,YAAI,CAAC,KAAK,QAAQ,MAAM,gBAAgB,UAAU,CAAC,EAAG,QAAO;AAC7D,uBAAe;AAAA,MAChB;AAAA,IACD;AACA,WAAO,KAAK,gBAAgB,QAAQ,cAAc,YAA2B;AAAA,EAC9E;AAAA,EACA,OAAO,QAAQ,QAA8B,SAA+B;AAC3E,WAAO,KAAK,SAAS,MAAM,EAAE,QAAQ,KAAK,SAAS,OAAO,EAAE;AAAA,EAC7D;AAAA,EACA,OAAO,yBAAyB,OAAoB,MAAM;AACzD,UAAM,WAAW,CAAC;AAClB,eAAW,WAAW,KAAK,YAAY,GAAG;AACzC,UAAI,CAAC,QAAQ,sBAAsB,CAAC,QAAQ,cAAe;AAG3D,YAAM,YAAY,QAAQ,qBAAqB,MAAM;AACrD,eAAS,KAAK,GAAG,SAAS,GAAG,QAAQ,OAAO,EAAE;AAC9C,UAAI,QAAQ,QAAQ,QAAQ;AAC3B,mBAAW,SAAS,QAAQ,SAAS;AAGpC,mBAAS,KAAK,GAAG,SAAS,GAAG,QAAQ,QAAQ,QAAQ,QAAQ,KAAK,KAAK,CAAC,EAAE;AAAA,QAC3E;AAAA,MACD;AAAA,IACD;AACA,WAAO;AAAA,MACN,GAAG;AAAA,MACH,GAAG;AAAA,IACJ;AAAA,EACD;AAAA,EACA,OAAO,gBACN,QACA,cACA,cACC;AACD,QAAI,CAAC,cAAc;AAClB,aAAO,CAAC,CAAC;AAAA,IACV;AACA,QAAI,OAAO,iBAAiB,UAAU;AACrC,aAAO,CAAC,CAAC;AAAA,IACV;AACA,QAAI,aAAa,SAAS,YAAY,GAAG;AACxC,aAAO;AAAA,IACR;AACA,QAAI,aAAa,SAAS,GAAG,GAAG;AAC/B,aAAO;AAAA,IACR;AACA,QAAI,aAAa,SAAS,GAAG,KAAK,KAAK,SAAS,MAAM,EAAE,OAAO,KAAK,SAAS,YAAY,EAAE,MAAM;AAChG,aAAO;AAAA,IACR;AACA,WAAO;AAAA,EACR;AAAA,EACA,OAAO,iBAAiB,MAAY,YAA+C;AAClF,UAAM,UAAU,OAAO,KAAK,OAAO,MAAM;AACzC,WAAO,QAAQ,OAAO,kBAAgB,KAAK,cAAc,MAAM,YAAY,YAAY,CAAC;AAAA,EACzF;AAAA,EACA,OAAO,cAAc,QAAuC;AAC3D,QAAI,OAAO,WAAW,EAAG,QAAO;AAChC,WAAO,CAAC,gBAAgB,KAAK,MAAM;AAAA,EACpC;AAAA,EACA,OAAO,YAAY,OAAmC;AACrD,QAAI,OAAO,cAAc,SAAS,KAA6B,EAAG,QAAO;AACzE,WAAO,CAAC,UAAK,KAAK,YAAY,WAAW,iBAAiB,WAAW,EAAE,SAAS,KAAK;AAAA,EACtF;AAAA,EACA;AAAA,SAAO,mBAAmB;AAAA;AAAA,EAC1B;AAAA,SAAO,qBAAqB;AAAA;AAC7B;AAEO,MAAM,iBAAiB,KAAK;AAAA,EAElC,YAAY,MAAiB;AAC5B,UAAM;AACN,SAAK,OAAO;AAAA,EACb;AAAA,EACS,IAAI,UAAkC;AAC9C,UAAM,KAAK,OAAO,aAAa,WAAW,WAAW,SAAS;AAE9D,UAAM,aAA0B,KAAK,KAAK,SAAS,KAAK,KAAK,OAAO,OACnE,KAAK,KAAK,SAAS,cAAc,OAAO,MAAM,aAAa;AAC5D,UAAM,cAAc,aAAa,WAAW,IAAI,QAAQ,IAAI,KAAK,cAAc;AAE/E,QAAI,KAAK,IAAI,EAAE,GAAG;AAEjB,YAAM,YAAY,KAAK,UAAU,EAAE;AACnC,UAAI,QAAQ,OAAO,mBAAmB,GAAG,SAAS,GAAG,WAAW,EAAE;AAClE,UAAI,CAAC,OAAO;AAEX,cAAM,WAAW,KAAK,SAAS,WAAW,EAAE,MAAM,SAAS,CAAC,EAAE;AAC9D,cAAM,aAAa,KAAK,SAAS,WAAW,EAAE;AAC9C,YAAI,cAAc,MAAM,iBAAiB,cAAc,MAAM,eAAe,cAAc,KAAK;AAE9F,kBAAQ;AAAA,QACT,OAAO;AACN,kBAAS,WAAW,aAAa,YAAY;AAAA,QAC9C;AACA,eAAO,mBAAmB,GAAG,SAAS,GAAG,WAAW,EAAE,IAAI;AAAA,MAC3D;AACA,aAAO;AAAA,IACR;AAEA,WAAO;AAAA,EACR;AAAA,EACS,mBAAmB,MAAY;AACvC,UAAM,SAAS,MAAM,mBAAmB,IAAI;AAC5C,QAAI,CAAC,KAAK,KAAK,WAAW,WAAW,KAAK,WAAW;AACpD,YAAM,eAAe,KAAK,SAAS,MAAM,EAAE;AAC3C,UAAI,aAAc,QAAO;AAAA,IAC1B;AAKA,QAAI,KAAK,KAAK,SAAS,cAAc,QAAQ,KAAK,IAAI,UAAU,GAAG;AAGlE,aAAO,MAAM,WAAW,IAAI,IAAI;AAAA,IACjC;AACA,WAAO;AAAA,EACR;AAAA;AAAA,EAEA,UAAU,IAAqB;AAC9B,WAAO,MAAM,IAAI,EAAE;AAAA,EACpB;AAAA,EACA,OAAO;AAEN,UAAM,OAAO,uBAAO,OAAO,IAAI;AAC/B,eAAW,CAAC,QAAQ,WAAW,KAAK,MAAM;AACzC,WAAK,MAAM,IAAI;AAAA,IAChB;AACA,IAAC,KAAK,KAAK,SAAiB,OAAO;AACnC,SAAK,KAAK,aAAa;AAAA,EACxB;AAAA,EACA,OAAO;AACN,eAAW,UAAU,KAAK,KAAK,SAAS,MAAM;AAC7C,YAAM,IAAI,QAAc,KAAK,KAAK,SAAS,KAAK,MAAM,CAAC;AAAA,IACxD;AAAA,EACD;AAAA,EACS,IAAI,IAAQ,QAAqB;AACzC,QAAI,WAAW,aAA4B;AAC1C,eAAS,KAAK,cAAc;AAAA,IAC7B;AACA,UAAM,IAAI,IAAI,MAAM;AACpB,SAAK,KAAK,SAAS,KAAK,EAAE,IAAI;AAC9B,SAAK,KAAK,aAAa;AAEvB,UAAM,OAAO,MAAM,IAAI,EAAE;AACzB,QAAI,KAAM,MAAK,KAAK,iBAAiB,IAAI;AACzC,WAAO;AAAA,EACR;AAAA,EACS,OAAO,IAAQ;AACvB,QAAI,CAAC,KAAK,IAAI,EAAE,EAAG,QAAO;AAC1B,UAAM,OAAO,EAAE;AACf,WAAO,KAAK,KAAK,SAAS,KAAK,EAAE;AACjC,SAAK,KAAK,aAAa;AACvB,WAAO;AAAA,EACR;AACD;AAEO,MAAM,mBAAmB,KAAK;AAAA,EAGpC,cAAc;AACb,UAAM;AAHP,qBAAY,oBAAI,IAAgB;AAChC,0BAAiB,oBAAI,IAAqB;AAGzC,SAAK,KAAK;AAAA,EACX;AAAA,EACA,OAAO;AACN,sBAAG,uBAAuB,EAAE,YAAY,MAAM;AAC7C,UAAI,SAAS;AACb,iBAAW,CAAC,QAAQ,WAAW,KAAK,MAAM;AACzC,kBAAU,GAAG,KAAK,UAAU,IAAI,MAAM,KAAK,MAAM,IAAI,WAAW,IAAI,KAAK,eAAe,IAAI,MAAM,KAAK,EAAE;AAAA;AAAA,MAC1G;AACA,aAAO;AAAA,IACR,CAAC;AAAA,EACF;AAAA,EACA,OAAO;AACN,UAAM,WAAO,cAAG,uBAAuB,EAAE,iBAAiB;AAC1D,eAAW,OAAO,KAAK,MAAM,IAAI,GAAG;AACnC,UAAI,CAAC,IAAK;AACV,YAAM,CAAC,MAAM,QAAQ,SAAS,IAAI,IAAI,MAAM,GAAG;AAC/C,YAAM,SAAK,sBAAK,IAAI;AACpB,UAAI,CAAC,IAAI;AACR,gBAAQ,KAAK,kDAAkD;AAC/D,gBAAQ,KAAK,GAAG;AAChB;AAAA,MACD;AACA,WAAK,UAAU,IAAI,IAAI,IAAI;AAC3B,UAAI,UAAW,MAAK,eAAe,IAAI,IAAI,SAAwB;AAGnE,YAAM,YAAY,OAAO,OAAO,CAAC;AAMjC,YAAM,oBAAoB,MAAM,IAAI,EAAE,IAAI,MAAM,IAAI,EAAE,IAAI;AAE1D,UAAI,qBAAqB,KAAK,QAAQ,mBAAmB,SAAS,EAAG;AACrE,YAAM,IAAI,IAAI,SAAS;AAAA,IACxB;AAAA,EACD;AAAA,EACS,IAAI,IAAQ,OAAoB,UAAmB;AAC3D,QAAI,CAAC,SAAU,YAAW;AAC1B,UAAM,OAAO,MAAM,IAAI,IAAI,IAAI;AAC/B,QAAI,MAAM;AACT,WAAK,YAAY;AACjB,WAAK,eAAe;AACpB,iBAAW,KAAK;AAChB,YAAM,OAAO,cAAc,IAAI;AAAA,IAChC;AACA,SAAK,UAAU,IAAI,IAAI,QAAQ;AAC/B,UAAM,IAAI,IAAI,KAAK;AACnB,SAAK,KAAK,KAAK;AACf,WAAO;AAAA,EACR;AAAA,EACS,OAAO,IAAQ;AACvB,QAAI,CAAC,MAAM,IAAI,EAAE,EAAG,QAAO;AAC3B,UAAM,OAAO,EAAE;AACf,UAAM,OAAO,MAAM,IAAI,EAAE;AACzB,QAAI,MAAM;AACT,WAAK,YAAY;AAAA,IAClB;AACA,SAAK,UAAU,OAAO,EAAE;AACxB,SAAK,KAAK;AACV,WAAO;AAAA,EACR;AAAA,EACA,WAAW,IAAQ,WAAwB,UAAmB;AAC7D,QAAI,CAAC,SAAU,YAAW;AAC1B,UAAM,OAAO,MAAM,IAAI,EAAE;AACzB,QAAI,MAAM;AACT,WAAK,eAAe;AACpB,iBAAW,KAAK;AAChB,YAAM,OAAO,cAAc,IAAI;AAAA,IAChC;AACA,QAAI,CAAC,MAAM,IAAI,EAAE,EAAG,MAAK,IAAI,IAAI,KAAK,QAAQ;AAC9C,SAAK,eAAe,IAAI,IAAI,SAAS;AACrC,SAAK,KAAK,KAAK;AACf,WAAO;AAAA,EACR;AAAA,EACA,cAAc,IAAQ;AACrB,QAAI,CAAC,KAAK,eAAe,IAAI,EAAE,EAAG,QAAO;AACzC,SAAK,eAAe,OAAO,EAAE;AAC7B,QAAI,MAAM,IAAI,EAAE,MAAM,KAAK;AAC1B,aAAO,KAAK,OAAO,EAAE;AAAA,IACtB;AACA,UAAM,OAAO,MAAM,IAAI,EAAE;AACzB,QAAI,MAAM;AACT,WAAK,eAAe;AACpB,YAAM,OAAO,cAAc,IAAI;AAAA,IAChC;AACA,SAAK,KAAK;AACV,WAAO;AAAA,EACR;AACD;",
  "names": []
}
